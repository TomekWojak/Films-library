import{getData,createBrowsePage,createMainHeroSection,showErrorPopup,showBigLoader,hideBigLoader,createFilmSlider}from"./components.min.js";document.addEventListener("DOMContentLoaded",function(){const e={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzNTYwZjM4MjU3NDQ1ZGE1ZGZkYTYxYzE0YWM4YmM4MyIsIm5iZiI6MTc1OTc2NTAzOC45NCwic3ViIjoiNjhlM2UyMmUyNjY5NzY4MzhlYzI3NzI5Iiwic2NvcGVzIjpbImFwaV9yZWFkIl0sInZlcnNpb24iOjF9.nuGfEjclJLepmzzHi2omNhp29THgrJf9Nv6D4_gTdxA"}},t=new Map;let r,a=1e4,o=0;const n="&page=",s=async(t,r,...a)=>{const o=[];for await(const s of a){const a=s+t+n+r,i=await fetch(a,e),c=await i.json();o.push(c)}return o},i=async(t,r,a)=>{const o=a+t+n+r;try{const t=await fetch(o,e);return await t.json()}catch{showErrorPopup(translations.browsePage.loadingDataError,"#dc4a34")}},c=async(e,t)=>{const r=[];for(let a=1;a<=t;a++)r.push(i(e,a,"https://api.themoviedb.org/3/movie/popular?language="));try{return await Promise.all(r)}catch{showErrorPopup(translations.browsePage.loadingDataError,"#dc4a34")}},l=async(e,t)=>{try{const r=await e(t,5),a=Math.trunc(20*Math.random());return r.map(e=>e.results[a])}catch{showErrorPopup(translations.browsePage.loadingDataError,"#dc4a34")}finally{hideBigLoader()}},d=(e,t)=>{const r=e.querySelector(".browse-main__images"),a=r.querySelectorAll(".browse-main__img-box"),n=e.querySelector(".browse-main__carousell-controls");a.forEach(e=>e.classList.remove("currentVisible")),r.style.transform=`translateX(${100*-o}%)`,h(o,n),a[o].classList.add("currentVisible"),o++,o>t.length-1&&(o=0),g(e)},h=(e,r)=>{const a=r.querySelectorAll(".browse-main__btn"),o=r.querySelector(`.browse-main__btn[data-img="${e}"]`),n=o.querySelector(".browse-main__progress-bar"),s=r.querySelectorAll(".browse-main__progress-bar");t.forEach(e=>clearInterval(e)),t.clear(),s.forEach(e=>e.style.width="0"),m(n,e),a.forEach(e=>e.classList.remove("active")),o.classList.add("active")},m=(e,r)=>{t.has(r)&&clearInterval(t.get(r));let a=0;const o=setInterval(()=>{a+=2,e.style.width=`${a}%`,a>=100&&(e.style.width="0",clearInterval(o),t.delete(r))},200);t.set(r,o)},u=(e,t)=>{t.querySelector(".browse-main__carousell-controls").addEventListener("click",n=>{if(n.target.matches(".browse-main__btn")){if(n.target.classList.contains("active"))return;clearInterval(r);const s=n.target,i=parseInt(s.dataset.img);o=i,d(t,e),r=setInterval(()=>{d(t,e)},a)}})},g=e=>{e.querySelectorAll(".browse-main__img-box").forEach(e=>{const t=e.classList.contains("currentVisible")?0:-1;b(e,t,0===t?"visible":"hidden")})},b=(e,t,r)=>{const a=e.querySelector(".browse-main__trailer-btn"),o=e.querySelector(".browse-main__see-more-btn");a.setAttribute("tabindex",t),o.setAttribute("tabindex",t),a.style.visibility=r,o.style.visibility=r};let w,p,y,_;const v=(e,t)=>{const n=Math.abs(w-p),s=Math.abs(y-_);n<50||s>30||(p-w>50?(o=(o-2+t.length)%t.length,d(e,t)):w-p>50&&d(e,t),clearInterval(r),r=setInterval(()=>{d(e,t)},a))},I=(e,t)=>{const r=e.querySelector(".browse-main__images");r.addEventListener("touchstart",e=>{(e=>{w=e.touches[0].clientX,y=e.touches[0].clientY})(e)}),r.addEventListener("touchend",r=>{((e,t,r)=>{p=e.changedTouches[0].clientX,_=e.changedTouches[0].clientY,v(t,r)})(r,e,t)})};let E=0;const S={maxIndex:16,threshold:25},f={maxIndex:6,threshold:100},L={maxIndex:9,threshold:100},x={maxIndex:10,threshold:25},q=()=>{const e=window.innerWidth;return e<576?L:e<992?f:e<1200?S:e>=1200?x:void 0},M=(e,t)=>{const{maxIndex:r}=q();t.toggleAttribute("disabled",0===E),e.toggleAttribute("disabled",E>=r)},N=e=>{const{threshold:t}=q();e.style.transform=`translateX(${-E*t}%)`},j=e=>{const t=e.querySelector(".browse-section__slider-images"),r=e.querySelector(".browse-section__slider-next-btn"),a=e.querySelector(".browse-section__slider-prev-btn");r.addEventListener("click",()=>((e,t,r)=>{const{maxIndex:a}=q();E>=a||(E++,N(e),M(t,r))})(t,r,a)),a.addEventListener("click",()=>((e,t,r)=>{E<=0||(E--,N(e),M(t,r))})(t,r,a)),M(r,a)};(async()=>{const e=getData(),t=e?.translations,o=e?.preferredLanguage,n=e?.loggedIn,i=document.querySelector(".container");if(e&&n){i.prepend(createBrowsePage(t)),i.append(showBigLoader());try{const e=await l(c,o);createMainHeroSection(e,t,i),d(i,e),r=setInterval(()=>d(i,e),a),u(e,i),I(i,e);const n=await s(o,1,"https://api.themoviedb.org/3/movie/upcoming?language="),h=document.querySelector("main");h||i.append(createFilmSlider(n,t,0,t.browseSection.sectionNames.upcoming)),h.append(createFilmSlider(n,t,0,t.browseSection.sectionNames.upcoming)),j(i)}catch{showErrorPopup(t.browsePage.loadingDataError,"#dc4a34")}finally{hideBigLoader()}}else window.location.href="/"})()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLm1pbi5qcyIsIm5hbWVzIjpbImdldERhdGEiLCJjcmVhdGVCcm93c2VQYWdlIiwiY3JlYXRlTWFpbkhlcm9TZWN0aW9uIiwic2hvd0Vycm9yUG9wdXAiLCJzaG93QmlnTG9hZGVyIiwiaGlkZUJpZ0xvYWRlciIsImNyZWF0ZUZpbG1TbGlkZXIiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcHRpb25zIiwibWV0aG9kIiwiaGVhZGVycyIsImFjY2VwdCIsIkF1dGhvcml6YXRpb24iLCJwcm9ncmVzc0JhckludGVydmFscyIsIk1hcCIsImNhcm91c2VsbEludGVydmFsIiwiY2Fyb3VzZWxsU3BlZWQiLCJpbmRleCIsIkZJTE1TX1BBR0VTX0FNT1VOVCIsImdldEFsbEZpbG1zIiwiYXN5bmMiLCJsYW5nIiwicGFnZU51bSIsInVybHMiLCJyZXNwb25zZXMiLCJ1cmwiLCJVUkwiLCJyZXNwb25zZSIsImZldGNoIiwiZGF0YSIsImpzb24iLCJwdXNoIiwiZ2V0RmlsbXMiLCJ0cmFuc2xhdGlvbnMiLCJicm93c2VQYWdlIiwibG9hZGluZ0RhdGFFcnJvciIsImxvYWRGaWxtc1RvQ2Fyb3VzZWxsIiwicmVxdWVzdHMiLCJpIiwiUHJvbWlzZSIsImFsbCIsImNob29zZUZpbG1zVG9DYXJvdXNlbGwiLCJjdXJyZW50TGFuZ3VhZ2UiLCJwYWdlc0RhdGEiLCJyYW5kb21OdW1iZXIiLCJNYXRoIiwidHJ1bmMiLCJyYW5kb20iLCJtYXAiLCJwYWdlIiwicmVzdWx0cyIsImhhbmRsZUZpbG1zQ2Fyb3VzZWxsIiwiY29udGFpbmVyIiwibW92aWVzIiwiaW1hZ2VTbGlkZXIiLCJxdWVyeVNlbGVjdG9yIiwiYWxsSW1hZ2VzIiwicXVlcnlTZWxlY3RvckFsbCIsImNhcm91c2VsbENvbnRyb2xzIiwiZm9yRWFjaCIsImltZyIsImNsYXNzTGlzdCIsInJlbW92ZSIsInN0eWxlIiwidHJhbnNmb3JtIiwiaGFuZGxlQ2Fyb3VzZWxsQ29udHJvbHNTdGF0ZSIsImFkZCIsImxlbmd0aCIsImhhbmRsZUJ0bnNWaXNpYmlsaXR5IiwiY2Fyb3VzZWxsQ29udHJvbHNCb3giLCJhbGxDb250cm9sQnRucyIsImN1cnJlbnRCdG4iLCJwcm9ncmVzc0JhciIsImFsbFByb2dyZXNzQmFycyIsImludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImNsZWFyIiwiYmFyIiwid2lkdGgiLCJjaGFuZ2VQcm9ncmVzc0JhciIsImJ0biIsImJ0bkluZGV4IiwiaGFzIiwiZ2V0IiwicHJvZ3Jlc3NCYXJJbnRlcnZhbCIsInNldEludGVydmFsIiwiZGVsZXRlIiwic2V0IiwiY2hhbmdlQ3VycmVudEltZyIsImUiLCJ0YXJnZXQiLCJtYXRjaGVzIiwiY29udGFpbnMiLCJpbWdEYXRhIiwicGFyc2VJbnQiLCJkYXRhc2V0IiwiZmlsbSIsInRhYmluZGV4IiwiZ2l2ZUJ0bnNBdHRyaWJ1dGUiLCJ2aXNpYmlsaXR5IiwidHJhaWxlckJ0biIsInNlZU1vcmVCdG4iLCJzZXRBdHRyaWJ1dGUiLCJzdGFydFgiLCJlbmRYIiwic3RhcnRZIiwiZW5kWSIsImhhbmRsZVN3aXBlIiwiaG9yaXpvbnRhbERpc3RhbmNlIiwiYWJzIiwidmVydGljYWxEaXN0YW5jZSIsInNldFRvdWNoRXZlbnRMaXN0ZW5lciIsInRvdWNoZXMiLCJjbGllbnRYIiwiY2xpZW50WSIsImhhbmRsZVRvdWNoU3RhcnRFdmVudCIsImNoYW5nZWRUb3VjaGVzIiwiaGFuZGxlVG91Y2hFbmRFdmVudCIsInNtYWxsQ2Fyb3VzZWxsSW5kZXgiLCJDQVJPVVNFTF9DT05GSUciLCJtYXhJbmRleCIsInRocmVzaG9sZCIsImdldENhcm91c2VsQ29uZmlnIiwid2luZG93IiwiaW5uZXJXaWR0aCIsInVwZGF0ZUJ1dHRvblN0YXRlcyIsIm5leHRCdG4iLCJwcmV2QnRuIiwidG9nZ2xlQXR0cmlidXRlIiwibW92ZVNsaWRlciIsInNsaWRlciIsInByZXBhcmVDYXJvdXNlbEl0ZW1zIiwic2hvd05leHRTbGlkZSIsInNob3dQcmV2U2xpZGUiLCJ1c2VyRGF0YSIsInByZWZlcnJlZExhbmd1YWdlIiwiaXNMb2dnZWRJbiIsImxvZ2dlZEluIiwicHJlcGVuZCIsImFwcGVuZCIsImZpbG1zIiwibWFpbiIsImJyb3dzZVNlY3Rpb24iLCJzZWN0aW9uTmFtZXMiLCJ1cGNvbWluZyIsImxvY2F0aW9uIiwiaHJlZiIsImNoZWNrQXV0aG9yaXphdGlvbiJdLCJzb3VyY2VzIjpbIm1haW4tcGFnZS5qcyJdLCJtYXBwaW5ncyI6Ik9BQ0NBLFFBQ0FDLGlCQUNBQyxzQkFDQUMsZUFDQUMsY0FDQUMsY0FDQUMscUJBQ00sc0JBQ1BDLFNBQVNDLGlCQUFpQixtQkFBb0IsV0FFN0MsTUFHTUMsRUFBVSxDQUNmQyxPQUFRLE1BQ1JDLFFBQVMsQ0FDUkMsT0FBUSxtQkFDUkMsY0FDQyx5UEFHR0MsRUFBdUIsSUFBSUMsSUFDakMsSUFLSUMsRUFMQUMsRUFBaUIsSUFJakJDLEVBQVEsRUFHWixNQUVNQyxFQUFxQixTQW9FckJDLEVBQWNDLE1BQU9DLEVBQU1DLEtBQVlDLEtBQzVDLE1BQU1DLEVBQVksR0FDbEIsVUFBVyxNQUFNQyxLQUFPRixFQUFNLENBQzdCLE1BQU1HLEVBQU1ELEVBQU1KLEVBQU9ILEVBQXFCSSxFQUN4Q0ssUUFBaUJDLE1BQU1GLEVBQUtsQixHQUM1QnFCLFFBQWFGLEVBQVNHLE9BRTVCTixFQUFVTyxLQUFLRixFQUNoQixDQUNBLE9BQU9MLEdBR0ZRLEVBQVdaLE1BQU9DLEVBQU1DLEVBQVNHLEtBQ3RDLE1BQU1DLEVBQU1ELEVBQU1KLEVBQU9ILEVBQXFCSSxFQUU5QyxJQUNDLE1BQU1LLFFBQWlCQyxNQUFNRixFQUFLbEIsR0FHbEMsYUFGbUJtQixFQUFTRyxNQUc3QixDQUFFLE1BQ0Q1QixlQUFlK0IsYUFBYUMsV0FBV0MsaUJBQWtCLFVBQzFELEdBR0tDLEVBQXVCaEIsTUFBT0MsRUFBTUMsS0FDekMsTUFBTWUsRUFBVyxHQUVqQixJQUFLLElBQUlDLEVBQUksRUFBR0EsR0FBS2hCLEVBQVNnQixJQUM3QkQsRUFBU04sS0FBS0MsRUFBU1gs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QixFQUFVdUYsT0FBT3hJLGlCQUVqQixJQUNDLE1BQU1rRCxRQUFlWixFQUNwQkwsRUFDQU0sR0FHRHpDLHNCQUFzQm9ELEVBQVFwQixFQUFjbUIsR0FDNUNELEVBQXFCQyxFQUFXQyxHQUVoQ3RDLEVBQW9Cc0UsWUFDbkIsSUFBTWxDLEVBQXFCQyxFQUFXQyxHQUN0Q3JDLEdBR0R3RSxFQUFpQm5DLEVBQVFELEdBQ3pCMkQsRUFBc0IzRCxFQUFXQyxHQUVqQyxNQUFNdUYsUUFBY3pILEVBQ25CdUIsRUF2RHFCLEVBa0JHLHlEQTBDbkJtRyxFQUFPdkksU0FBU2lELGNBQWMsUUFDL0JzRixHQUNKekYsRUFBVXVGLE9BQ1R0SSxpQkFDQ3VJLEVBQ0EzRyxFQUNBLEVBQ0FBLEVBQWE2RyxjQUFjQyxhQUFhQyxXQUkzQ0gsRUFBS0YsT0FDSnRJLGlCQUNDdUksRUFDQTNHLEVBQ0EsRUFDQUEsRUFBYTZHLGNBQWNDLGFBQWFDLFdBRzFDYixFQUFxQi9FLEVBQ3RCLENBQUUsTUFDRGxELGVBQWUrQixFQUFhQyxXQUFXQyxpQkFBa0IsVUFDMUQsQ0FBRSxRQUNEL0IsZUFDRCxDQXBEQSxNQUZDdUgsT0FBT3NCLFNBQVNDLEtBQU8sS0E4VXpCQyxFQUNEIiwiaWdub3JlTGlzdCI6W10sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcblx0Z2V0RGF0YSxcclxuXHRjcmVhdGVCcm93c2VQYWdlLFxyXG5cdGNyZWF0ZU1haW5IZXJvU2VjdGlvbixcclxuXHRzaG93RXJyb3JQb3B1cCxcclxuXHRzaG93QmlnTG9hZGVyLFxyXG5cdGhpZGVCaWdMb2FkZXIsXHJcblx0Y3JlYXRlRmlsbVNsaWRlcixcclxufSBmcm9tIFwiLi9jb21wb25lbnRzLm1pbi5qc1wiO1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XHJcblx0Ly8gaHR0cHM6Ly9hcGkudGhlbW92aWVkYi5vcmcvMy9kaXNjb3Zlci9tb3ZpZT9sYW5ndWFnZT1wbFxyXG5cdGNvbnN0IENBUk9VU0VMTF9MRU5HVEggPSA1O1xyXG5cdGNvbnN0IEZJTE1fQU1PVU5UX1BFUl9QQUdFID0gMjA7XHJcblx0Y29uc3QgRE9XTkxPQURFRF9QQUdFID0gMTtcclxuXHRjb25zdCBvcHRpb25zID0ge1xyXG5cdFx0bWV0aG9kOiBcIkdFVFwiLFxyXG5cdFx0aGVhZGVyczoge1xyXG5cdFx0XHRhY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG5cdFx0XHRBdXRob3JpemF0aW9uOlxyXG5cdFx0XHRcdFwiQmVhcmVyIGV5SmhiR2NpT2lKSVV6STFOaUo5LmV5SmhkV1FpT2lJek5UWXdaak00TWpVM05EUTFaR0UxWkdaa1lUWXhZekUwWVdNNFltTTRNeUlzSW01aVppSTZNVGMxT1RjMk5UQXpPQzQ1TkN3aWMzVmlJam9pTmpobE0yVXlNbVV5TmpZNU56WTRNemhsWXpJM056STVJaXdpYzJOdmNHVnpJanBiSW1Gd2FWOXlaV0ZrSWwwc0luWmxjbk5wYjI0aU9qRjkubnVHZkVqY2xKTGVwbXp6SGkyb21OaHAyOVRIZ3JKZjlOdjZENF9nVGR4QVwiLFxyXG5cdFx0fSxcclxuXHR9O1xyXG5cdGNvbnN0IHByb2dyZXNzQmFySW50ZXJ2YWxzID0gbmV3IE1hcCgpO1xyXG5cdGxldCBjYXJvdXNlbGxTcGVlZCA9IDEwMDAwO1xyXG5cdGxldCBjYXJvdXNlbGxTdHJva2VSYW5nZSA9IDI7XHJcblx0bGV0IGludGVydmFsU3BlZWQgPSAoY2Fyb3VzZWxsU3BlZWQgKiBjYXJvdXNlbGxTdHJva2VSYW5nZSkgLyAxMDA7XHJcblx0bGV0IGNhcm91c2VsbFdpZHRoID0gMTAwO1xyXG5cdGxldCBpbmRleCA9IDA7XHJcblx0bGV0IGNhcm91c2VsbEludGVydmFsO1xyXG5cclxuXHRjb25zdCBQT1BVTEFSX0ZJTE1TX1VSTCA9IGBodHRwczovL2FwaS50aGVtb3ZpZWRiLm9yZy8zL21vdmllL3BvcHVsYXI/bGFuZ3VhZ2U9YDtcclxuXHRjb25zdCBVUENPTUlOR19GSUxNU19VUkwgPSBgaHR0cHM6Ly9hcGkudGhlbW92aWVkYi5vcmcvMy9tb3ZpZS91cGNvbWluZz9sYW5ndWFnZT1gO1xyXG5cdGNvbnN0IEZJTE1TX1BBR0VTX0FNT1VOVCA9IGAmcGFnZT1gO1xyXG5cclxuXHRjb25zdCBjaGVja0F1dGhvcml6YXRpb24gPSBhc3luYyAoKSA9PiB7XHJcblx0XHRjb25zdCB1c2VyRGF0YSA9IGdldERhdGEoKTtcclxuXHRcdGNvbnN0IHRyYW5zbGF0aW9ucyA9IHVzZXJEYXRhPy50cmFuc2xhdGlvbnM7XHJcblx0XHRjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSB1c2VyRGF0YT8ucHJlZmVycmVkTGFuZ3VhZ2U7XHJcblx0XHRjb25zdCBpc0xvZ2dlZEluID0gdXNlckRhdGE/LmxvZ2dlZEluO1xyXG5cclxuXHRcdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyXCIpO1xyXG5cclxuXHRcdGlmICghdXNlckRhdGEgfHwgIWlzTG9nZ2VkSW4pIHtcclxuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnRhaW5lci5wcmVwZW5kKGNyZWF0ZUJyb3dzZVBhZ2UodHJhbnNsYXRpb25zKSk7XHJcblx0XHRjb250YWluZXIuYXBwZW5kKHNob3dCaWdMb2FkZXIoKSk7XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Y29uc3QgbW92aWVzID0gYXdhaXQgY2hvb3NlRmlsbXNUb0Nhcm91c2VsbChcclxuXHRcdFx0XHRsb2FkRmlsbXNUb0Nhcm91c2VsbCxcclxuXHRcdFx0XHRjdXJyZW50TGFuZ3VhZ2VcclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdGNyZWF0ZU1haW5IZXJvU2VjdGlvbihtb3ZpZXMsIHRyYW5zbGF0aW9ucywgY29udGFpbmVyKTtcclxuXHRcdFx0aGFuZGxlRmlsbXNDYXJvdXNlbGwoY29udGFpbmVyLCBtb3ZpZXMpO1xyXG5cclxuXHRcdFx0Y2Fyb3VzZWxsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChcclxuXHRcdFx0XHQoKSA9PiBoYW5kbGVGaWxtc0Nhcm91c2VsbChjb250YWluZXIsIG1vdmllcyksXHJcblx0XHRcdFx0Y2Fyb3VzZWxsU3BlZWRcclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdGNoYW5nZUN1cnJlbnRJbWcobW92aWVzLCBjb250YWluZXIpO1xyXG5cdFx0XHRzZXRUb3VjaEV2ZW50TGlzdGVuZXIoY29udGFpbmVyLCBtb3ZpZXMpO1xyXG5cclxuXHRcdFx0Y29uc3QgZmlsbXMgPSBhd2FpdCBnZXRBbGxGaWxtcyhcclxuXHRcdFx0XHRjdXJyZW50TGFuZ3VhZ2UsXHJcblx0XHRcdFx0RE9XTkxPQURFRF9QQUdFLFxyXG5cdFx0XHRcdFVQQ09NSU5HX0ZJTE1TX1VSTFxyXG5cdFx0XHQpO1xyXG5cclxuXHRcdFx0Y29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xyXG5cdFx0XHRpZiAoIW1haW4pIHtcclxuXHRcdFx0XHRjb250YWluZXIuYXBwZW5kKFxyXG5cdFx0XHRcdFx0Y3JlYXRlRmlsbVNsaWRlcihcclxuXHRcdFx0XHRcdFx0ZmlsbXMsXHJcblx0XHRcdFx0XHRcdHRyYW5zbGF0aW9ucyxcclxuXHRcdFx0XHRcdFx0MCxcclxuXHRcdFx0XHRcdFx0dHJhbnNsYXRpb25zLmJyb3dzZVNlY3Rpb24uc2VjdGlvbk5hbWVzLnVwY29taW5nXHJcblx0XHRcdFx0XHQpXHJcblx0XHRcdFx0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRtYWluLmFwcGVuZChcclxuXHRcdFx0XHRjcmVhdGVGaWxtU2xpZGVyKFxyXG5cdFx0XHRcdFx0ZmlsbXMsXHJcblx0XHRcdFx0XHR0cmFuc2xhdGlvbnMsXHJcblx0XHRcdFx0XHQwLFxyXG5cdFx0XHRcdFx0dHJhbnNsYXRpb25zLmJyb3dzZVNlY3Rpb24uc2VjdGlvbk5hbWVzLnVwY29taW5nXHJcblx0XHRcdFx0KVxyXG5cdFx0XHQpO1xyXG5cdFx0XHRwcmVwYXJlQ2Fyb3VzZWxJdGVtcyhjb250YWluZXIpO1xyXG5cdFx0fSBjYXRjaCB7XHJcblx0XHRcdHNob3dFcnJvclBvcHVwKHRyYW5zbGF0aW9ucy5icm93c2VQYWdlLmxvYWRpbmdEYXRhRXJyb3IsIFwiI2RjNGEzNFwiKTtcclxuXHRcdH0gZmluYWxseSB7XHJcblx0XHRcdGhpZGVCaWdMb2FkZXIoKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRjb25zdCBnZXRBbGxGaWxtcyA9IGFzeW5jIChsYW5nLCBwYWdlTnVtLCAuLi51cmxzKSA9PiB7XHJcblx0XHRjb25zdCByZXNwb25zZXMgPSBbXTtcclxuXHRcdGZvciBhd2FpdCAoY29uc3QgdXJsIG9mIHVybHMpIHtcclxuXHRcdFx0Y29uc3QgVVJMID0gdXJsICsgbGFuZyArIEZJTE1TX1BBR0VTX0FNT1VOVCArIHBhZ2VOdW07XHJcblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goVVJMLCBvcHRpb25zKTtcclxuXHRcdFx0Y29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcblx0XHRcdHJlc3BvbnNlcy5wdXNoKGRhdGEpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlc3BvbnNlcztcclxuXHR9O1xyXG5cclxuXHRjb25zdCBnZXRGaWxtcyA9IGFzeW5jIChsYW5nLCBwYWdlTnVtLCB1cmwpID0+IHtcclxuXHRcdGNvbnN0IFVSTCA9IHVybCArIGxhbmcgKyBGSUxNU19QQUdFU19BTU9VTlQgKyBwYWdlTnVtO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goVVJMLCBvcHRpb25zKTtcclxuXHRcdFx0Y29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcblx0XHRcdHJldHVybiBkYXRhO1xyXG5cdFx0fSBjYXRjaCB7XHJcblx0XHRcdHNob3dFcnJvclBvcHVwKHRyYW5zbGF0aW9ucy5icm93c2VQYWdlLmxvYWRpbmdEYXRhRXJyb3IsIFwiI2RjNGEzNFwiKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRjb25zdCBsb2FkRmlsbXNUb0Nhcm91c2VsbCA9IGFzeW5jIChsYW5nLCBwYWdlTnVtKSA9PiB7XHJcblx0XHRjb25zdCByZXF1ZXN0cyA9IFtdO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAxOyBpIDw9IHBhZ2VOdW07IGkrKykge1xyXG5cdFx0XHRyZXF1ZXN0cy5wdXNoKGdldEZpbG1zKGxhbmcsIGksIFBPUFVMQVJfRklMTVNfVVJMKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Y29uc3QgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGwocmVxdWVzdHMpO1xyXG5cdFx0XHRyZXR1cm4gcmVzcG9uc2VzO1xyXG5cdFx0fSBjYXRjaCB7XHJcblx0XHRcdHNob3dFcnJvclBvcHVwKHRyYW5zbGF0aW9ucy5icm93c2VQYWdlLmxvYWRpbmdEYXRhRXJyb3IsIFwiI2RjNGEzNFwiKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRjb25zdCBjaG9vc2VGaWxtc1RvQ2Fyb3VzZWxsID0gYXN5bmMgKGRhdGEsIGN1cnJlbnRMYW5ndWFnZSkgPT4ge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Y29uc3QgcGFnZXNEYXRhID0gYXdhaXQgZGF0YShjdXJyZW50TGFuZ3VhZ2UsIENBUk9VU0VMTF9MRU5HVEgpO1xyXG5cdFx0XHRjb25zdCByYW5kb21OdW1iZXIgPSBNYXRoLnRydW5jKE1hdGgucmFuZG9tKCkgKiBGSUxNX0FNT1VOVF9QRVJfUEFHRSk7XHJcblx0XHRcdGNvbnN0IGNob29zZW5Nb3ZpZXMgPSBwYWdlc0RhdGEubWFwKChwYWdlKSA9PiBwYWdlLnJlc3VsdHNbcmFuZG9tTnVtYmVyXSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gY2hvb3Nlbk1vdmllcztcclxuXHRcdH0gY2F0Y2gge1xyXG5cdFx0XHRzaG93RXJyb3JQb3B1cCh0cmFuc2xhdGlvbnMuYnJvd3NlUGFnZS5sb2FkaW5nRGF0YUVycm9yLCBcIiNkYzRhMzRcIik7XHJcblx0XHR9IGZpbmFsbHkge1xyXG5cdFx0XHRoaWRlQmlnTG9hZGVyKCk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly8gQ0FST1VTRUxMXHJcblxyXG5cdGNvbnN0IGhhbmRsZUZpbG1zQ2Fyb3VzZWxsID0gKGNvbnRhaW5lciwgbW92aWVzKSA9PiB7XHJcblx0XHRjb25zdCBpbWFnZVNsaWRlciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLmJyb3dzZS1tYWluX19pbWFnZXNcIik7XHJcblx0XHRjb25zdCBhbGxJbWFnZXMgPSBpbWFnZVNsaWRlci5xdWVyeVNlbGVjdG9yQWxsKFwiLmJyb3dzZS1tYWluX19pbWctYm94XCIpO1xyXG5cdFx0Y29uc3QgY2Fyb3VzZWxsQ29udHJvbHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcclxuXHRcdFx0XCIuYnJvd3NlLW1haW5fX2Nhcm91c2VsbC1jb250cm9sc1wiXHJcblx0XHQpO1xyXG5cdFx0YWxsSW1hZ2VzLmZvckVhY2goKGltZykgPT4gaW1nLmNsYXNzTGlzdC5yZW1vdmUoXCJjdXJyZW50VmlzaWJsZVwiKSk7XHJcblxyXG5cdFx0aW1hZ2VTbGlkZXIuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHstaW5kZXggKiBjYXJvdXNlbGxXaWR0aH0lKWA7XHJcblx0XHRoYW5kbGVDYXJvdXNlbGxDb250cm9sc1N0YXRlKGluZGV4LCBjYXJvdXNlbGxDb250cm9scyk7XHJcblx0XHRhbGxJbWFnZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJjdXJyZW50VmlzaWJsZVwiKTtcclxuXHJcblx0XHRpbmRleCsrO1xyXG5cclxuXHRcdGlmIChpbmRleCA+IG1vdmllcy5sZW5ndGggLSAxKSBpbmRleCA9IDA7XHJcblxyXG5cdFx0aGFuZGxlQnRuc1Zpc2liaWxpdHkoY29udGFpbmVyKTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBoYW5kbGVDYXJvdXNlbGxDb250cm9sc1N0YXRlID0gKGluZGV4LCBjYXJvdXNlbGxDb250cm9sc0JveCkgPT4ge1xyXG5cdFx0Y29uc3QgYWxsQ29udHJvbEJ0bnMgPVxyXG5cdFx0XHRjYXJvdXNlbGxDb250cm9sc0JveC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJyb3dzZS1tYWluX19idG5cIik7XHJcblx0XHRjb25zdCBjdXJyZW50QnRuID0gY2Fyb3VzZWxsQ29udHJvbHNCb3gucXVlcnlTZWxlY3RvcihcclxuXHRcdFx0YC5icm93c2UtbWFpbl9fYnRuW2RhdGEtaW1nPVwiJHtpbmRleH1cIl1gXHJcblx0XHQpO1xyXG5cdFx0Y29uc3QgcHJvZ3Jlc3NCYXIgPSBjdXJyZW50QnRuLnF1ZXJ5U2VsZWN0b3IoXCIuYnJvd3NlLW1haW5fX3Byb2dyZXNzLWJhclwiKTtcclxuXHRcdGNvbnN0IGFsbFByb2dyZXNzQmFycyA9IGNhcm91c2VsbENvbnRyb2xzQm94LnF1ZXJ5U2VsZWN0b3JBbGwoXHJcblx0XHRcdFwiLmJyb3dzZS1tYWluX19wcm9ncmVzcy1iYXJcIlxyXG5cdFx0KTtcclxuXHJcblx0XHRwcm9ncmVzc0JhckludGVydmFscy5mb3JFYWNoKChpbnRlcnZhbCkgPT4gY2xlYXJJbnRlcnZhbChpbnRlcnZhbCkpO1xyXG5cdFx0cHJvZ3Jlc3NCYXJJbnRlcnZhbHMuY2xlYXIoKTtcclxuXHJcblx0XHRhbGxQcm9ncmVzc0JhcnMuZm9yRWFjaCgoYmFyKSA9PiAoYmFyLnN0eWxlLndpZHRoID0gXCIwXCIpKTtcclxuXHJcblx0XHRjaGFuZ2VQcm9ncmVzc0Jhcihwcm9ncmVzc0JhciwgaW5kZXgpO1xyXG5cclxuXHRcdGFsbENvbnRyb2xCdG5zLmZvckVhY2goKGJ0bikgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xyXG5cdFx0Y3VycmVudEJ0bi5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGNoYW5nZVByb2dyZXNzQmFyID0gKHByb2dyZXNzQmFyLCBidG5JbmRleCkgPT4ge1xyXG5cdFx0aWYgKHByb2dyZXNzQmFySW50ZXJ2YWxzLmhhcyhidG5JbmRleCkpIHtcclxuXHRcdFx0Y2xlYXJJbnRlcnZhbChwcm9ncmVzc0JhckludGVydmFscy5nZXQoYnRuSW5kZXgpKTtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgd2lkdGggPSAwO1xyXG5cdFx0Y29uc3QgcHJvZ3Jlc3NCYXJJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuXHRcdFx0d2lkdGggKz0gY2Fyb3VzZWxsU3Ryb2tlUmFuZ2U7XHJcblx0XHRcdHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9JWA7XHJcblx0XHRcdGlmICh3aWR0aCA+PSAxMDApIHtcclxuXHRcdFx0XHRwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IFwiMFwiO1xyXG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NCYXJJbnRlcnZhbCk7XHJcblxyXG5cdFx0XHRcdHByb2dyZXNzQmFySW50ZXJ2YWxzLmRlbGV0ZShidG5JbmRleCk7XHJcblx0XHRcdH1cclxuXHRcdH0sIGludGVydmFsU3BlZWQpO1xyXG5cclxuXHRcdHByb2dyZXNzQmFySW50ZXJ2YWxzLnNldChidG5JbmRleCwgcHJvZ3Jlc3NCYXJJbnRlcnZhbCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgY2hhbmdlQ3VycmVudEltZyA9IChtb3ZpZXMsIGNvbnRhaW5lcikgPT4ge1xyXG5cdFx0Y29uc3QgY2Fyb3VzZWxsQ29udHJvbHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcclxuXHRcdFx0XCIuYnJvd3NlLW1haW5fX2Nhcm91c2VsbC1jb250cm9sc1wiXHJcblx0XHQpO1xyXG5cclxuXHRcdGNhcm91c2VsbENvbnRyb2xzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0XHRpZiAoZS50YXJnZXQubWF0Y2hlcyhcIi5icm93c2UtbWFpbl9fYnRuXCIpKSB7XHJcblx0XHRcdFx0aWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRjbGVhckludGVydmFsKGNhcm91c2VsbEludGVydmFsKTtcclxuXHJcblx0XHRcdFx0Y29uc3QgY3VycmVudEJ0biA9IGUudGFyZ2V0O1xyXG5cdFx0XHRcdGNvbnN0IGltZ0RhdGEgPSBwYXJzZUludChjdXJyZW50QnRuLmRhdGFzZXQuaW1nKTtcclxuXHJcblx0XHRcdFx0aW5kZXggPSBpbWdEYXRhO1xyXG5cdFx0XHRcdGhhbmRsZUZpbG1zQ2Fyb3VzZWxsKGNvbnRhaW5lciwgbW92aWVzKTtcclxuXHJcblx0XHRcdFx0Y2Fyb3VzZWxsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcblx0XHRcdFx0XHRoYW5kbGVGaWxtc0Nhcm91c2VsbChjb250YWluZXIsIG1vdmllcyk7XHJcblx0XHRcdFx0fSwgY2Fyb3VzZWxsU3BlZWQpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBoYW5kbGVCdG5zVmlzaWJpbGl0eSA9IChjb250YWluZXIpID0+IHtcclxuXHRcdGNvbnN0IGFsbEZpbG1zID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYnJvd3NlLW1haW5fX2ltZy1ib3hcIik7XHJcblxyXG5cdFx0YWxsRmlsbXMuZm9yRWFjaCgoZmlsbSkgPT4ge1xyXG5cdFx0XHRjb25zdCBpc0FjdGl2ZSA9IGZpbG0uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY3VycmVudFZpc2libGVcIik7XHJcblx0XHRcdGNvbnN0IHRhYmluZGV4ID0gaXNBY3RpdmUgPyAwIDogLTE7XHJcblx0XHRcdGNvbnN0IHZpc2liaWxpdHkgPSB0YWJpbmRleCA9PT0gMCA/IFwidmlzaWJsZVwiIDogXCJoaWRkZW5cIjtcclxuXHRcdFx0Z2l2ZUJ0bnNBdHRyaWJ1dGUoZmlsbSwgdGFiaW5kZXgsIHZpc2liaWxpdHkpO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHRjb25zdCBnaXZlQnRuc0F0dHJpYnV0ZSA9IChmaWxtLCB0YWJpbmRleCwgdmlzaWJpbGl0eSkgPT4ge1xyXG5cdFx0Y29uc3QgdHJhaWxlckJ0biA9IGZpbG0ucXVlcnlTZWxlY3RvcihcIi5icm93c2UtbWFpbl9fdHJhaWxlci1idG5cIik7XHJcblx0XHRjb25zdCBzZWVNb3JlQnRuID0gZmlsbS5xdWVyeVNlbGVjdG9yKFwiLmJyb3dzZS1tYWluX19zZWUtbW9yZS1idG5cIik7XHJcblxyXG5cdFx0dHJhaWxlckJ0bi5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCB0YWJpbmRleCk7XHJcblx0XHRzZWVNb3JlQnRuLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIHRhYmluZGV4KTtcclxuXHRcdHRyYWlsZXJCdG4uc3R5bGUudmlzaWJpbGl0eSA9IHZpc2liaWxpdHk7XHJcblx0XHRzZWVNb3JlQnRuLnN0eWxlLnZpc2liaWxpdHkgPSB2aXNpYmlsaXR5O1xyXG5cdH07XHJcblxyXG5cdGxldCBzdGFydFg7XHJcblx0bGV0IGVuZFg7XHJcblx0bGV0IHN0YXJ0WTtcclxuXHRsZXQgZW5kWTtcclxuXHJcblx0Y29uc3QgaGFuZGxlVG91Y2hTdGFydEV2ZW50ID0gKGUpID0+IHtcclxuXHRcdHN0YXJ0WCA9IGUudG91Y2hlc1swXS5jbGllbnRYO1xyXG5cdFx0c3RhcnRZID0gZS50b3VjaGVzWzBdLmNsaWVudFk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgaGFuZGxlVG91Y2hFbmRFdmVudCA9IChlLCBjb250YWluZXIsIG1vdmllcykgPT4ge1xyXG5cdFx0ZW5kWCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDtcclxuXHRcdGVuZFkgPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFk7XHJcblx0XHRoYW5kbGVTd2lwZShjb250YWluZXIsIG1vdmllcyk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgaGFuZGxlU3dpcGUgPSAoY29udGFpbmVyLCBtb3ZpZXMpID0+IHtcclxuXHRcdGNvbnN0IEhPUklaT05UQUxfUkFOR0UgPSA1MDtcclxuXHRcdGNvbnN0IFZFUlRJQ0FMX1JBTkdFID0gMzA7XHJcblxyXG5cdFx0Y29uc3QgaG9yaXpvbnRhbERpc3RhbmNlID0gTWF0aC5hYnMoc3RhcnRYIC0gZW5kWCk7XHJcblx0XHRjb25zdCB2ZXJ0aWNhbERpc3RhbmNlID0gTWF0aC5hYnMoc3RhcnRZIC0gZW5kWSk7XHJcblxyXG5cdFx0aWYgKFxyXG5cdFx0XHRob3Jpem9udGFsRGlzdGFuY2UgPCBIT1JJWk9OVEFMX1JBTkdFIHx8XHJcblx0XHRcdHZlcnRpY2FsRGlzdGFuY2UgPiBWRVJUSUNBTF9SQU5HRVxyXG5cdFx0KSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmIChlbmRYIC0gc3RhcnRYID4gSE9SSVpPTlRBTF9SQU5HRSkge1xyXG5cdFx0XHRpbmRleCA9IChpbmRleCAtIDIgKyBtb3ZpZXMubGVuZ3RoKSAlIG1vdmllcy5sZW5ndGg7XHJcblx0XHRcdGhhbmRsZUZpbG1zQ2Fyb3VzZWxsKGNvbnRhaW5lciwgbW92aWVzKTtcclxuXHRcdH0gZWxzZSBpZiAoc3RhcnRYIC0gZW5kWCA+IEhPUklaT05UQUxfUkFOR0UpIHtcclxuXHRcdFx0aGFuZGxlRmlsbXNDYXJvdXNlbGwoY29udGFpbmVyLCBtb3ZpZXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNsZWFySW50ZXJ2YWwoY2Fyb3VzZWxsSW50ZXJ2YWwpO1xyXG5cdFx0Y2Fyb3VzZWxsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcblx0XHRcdGhhbmRsZUZpbG1zQ2Fyb3VzZWxsKGNvbnRhaW5lciwgbW92aWVzKTtcclxuXHRcdH0sIGNhcm91c2VsbFNwZWVkKTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBzZXRUb3VjaEV2ZW50TGlzdGVuZXIgPSAoY29udGFpbmVyLCBtb3ZpZXMpID0+IHtcclxuXHRcdGNvbnN0IGltYWdlU2xpZGVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuYnJvd3NlLW1haW5fX2ltYWdlc1wiKTtcclxuXHJcblx0XHRpbWFnZVNsaWRlci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZSkgPT4ge1xyXG5cdFx0XHRoYW5kbGVUb3VjaFN0YXJ0RXZlbnQoZSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRpbWFnZVNsaWRlci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGUpID0+IHtcclxuXHRcdFx0aGFuZGxlVG91Y2hFbmRFdmVudChlLCBjb250YWluZXIsIG1vdmllcyk7XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRsZXQgc21hbGxDYXJvdXNlbGxJbmRleCA9IDA7XHJcblxyXG5cdGNvbnN0IENBUk9VU0VMX0NPTkZJRyA9IHtcclxuXHRcdGRlc2t0b3A6IHsgbWF4SW5kZXg6IDE2LCB0aHJlc2hvbGQ6IDI1IH0sXHJcblx0XHR0YWJsZXQ6IHsgbWF4SW5kZXg6IDYsIHRocmVzaG9sZDogMTAwIH0sXHJcblx0XHRtb2JpbGU6IHsgbWF4SW5kZXg6IDksIHRocmVzaG9sZDogMTAwIH0sXHJcblx0XHRkZXNrdG9wQmlnOiB7IG1heEluZGV4OiAxMCwgdGhyZXNob2xkOiAyNSB9LFxyXG5cdH07XHJcblxyXG5cdGNvbnN0IGdldENhcm91c2VsQ29uZmlnID0gKCkgPT4ge1xyXG5cdFx0Y29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuXHRcdGlmICh3aWR0aCA8IDU3NikgcmV0dXJuIENBUk9VU0VMX0NPTkZJRy5tb2JpbGU7XHJcblx0XHRpZiAod2lkdGggPCA5OTIpIHJldHVybiBDQVJPVVNFTF9DT05GSUcudGFibGV0O1xyXG5cdFx0aWYgKHdpZHRoIDwgMTIwMCkgcmV0dXJuIENBUk9VU0VMX0NPTkZJRy5kZXNrdG9wO1xyXG5cdFx0aWYgKHdpZHRoID49IDEyMDApIHJldHVybiBDQVJPVVNFTF9DT05GSUcuZGVza3RvcEJpZztcclxuXHR9O1xyXG5cclxuXHRjb25zdCB1cGRhdGVCdXR0b25TdGF0ZXMgPSAobmV4dEJ0biwgcHJldkJ0bikgPT4ge1xyXG5cdFx0Y29uc3QgeyBtYXhJbmRleCB9ID0gZ2V0Q2Fyb3VzZWxDb25maWcoKTtcclxuXHJcblx0XHRwcmV2QnRuLnRvZ2dsZUF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHNtYWxsQ2Fyb3VzZWxsSW5kZXggPT09IDApO1xyXG5cdFx0bmV4dEJ0bi50b2dnbGVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBzbWFsbENhcm91c2VsbEluZGV4ID49IG1heEluZGV4KTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBtb3ZlU2xpZGVyID0gKHNsaWRlcikgPT4ge1xyXG5cdFx0Y29uc3QgeyB0aHJlc2hvbGQgfSA9IGdldENhcm91c2VsQ29uZmlnKCk7XHJcblx0XHRzbGlkZXIuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHstc21hbGxDYXJvdXNlbGxJbmRleCAqIHRocmVzaG9sZH0lKWA7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc2hvd05leHRTbGlkZSA9IChzbGlkZXIsIG5leHRCdG4sIHByZXZCdG4pID0+IHtcclxuXHRcdGNvbnN0IHsgbWF4SW5kZXggfSA9IGdldENhcm91c2VsQ29uZmlnKCk7XHJcblxyXG5cdFx0aWYgKHNtYWxsQ2Fyb3VzZWxsSW5kZXggPj0gbWF4SW5kZXgpIHJldHVybjtcclxuXHJcblx0XHRzbWFsbENhcm91c2VsbEluZGV4Kys7XHJcblx0XHRtb3ZlU2xpZGVyKHNsaWRlcik7XHJcblx0XHR1cGRhdGVCdXR0b25TdGF0ZXMobmV4dEJ0biwgcHJldkJ0bik7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc2hvd1ByZXZTbGlkZSA9IChzbGlkZXIsIG5leHRCdG4sIHByZXZCdG4pID0+IHtcclxuXHRcdGlmIChzbWFsbENhcm91c2VsbEluZGV4IDw9IDApIHJldHVybjtcclxuXHJcblx0XHRzbWFsbENhcm91c2VsbEluZGV4LS07XHJcblx0XHRtb3ZlU2xpZGVyKHNsaWRlcik7XHJcblx0XHR1cGRhdGVCdXR0b25TdGF0ZXMobmV4dEJ0biwgcHJldkJ0bik7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgcHJlcGFyZUNhcm91c2VsSXRlbXMgPSAoY29udGFpbmVyKSA9PiB7XHJcblx0XHRjb25zdCBzbGlkZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5icm93c2Utc2VjdGlvbl9fc2xpZGVyLWltYWdlc1wiKTtcclxuXHRcdGNvbnN0IG5leHRCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5icm93c2Utc2VjdGlvbl9fc2xpZGVyLW5leHQtYnRuXCIpO1xyXG5cdFx0Y29uc3QgcHJldkJ0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLmJyb3dzZS1zZWN0aW9uX19zbGlkZXItcHJldi1idG5cIik7XHJcblxyXG5cdFx0bmV4dEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuXHRcdFx0c2hvd05leHRTbGlkZShzbGlkZXIsIG5leHRCdG4sIHByZXZCdG4pXHJcblx0XHQpO1xyXG5cdFx0cHJldkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuXHRcdFx0c2hvd1ByZXZTbGlkZShzbGlkZXIsIG5leHRCdG4sIHByZXZCdG4pXHJcblx0XHQpO1xyXG5cclxuXHRcdC8vIFVzdGF3aWFqIHN0YW55IHByenljaXNrw7N3IG5hIHN0YXJjaWVcclxuXHRcdHVwZGF0ZUJ1dHRvblN0YXRlcyhuZXh0QnRuLCBwcmV2QnRuKTtcclxuXHR9O1xyXG5cdGNoZWNrQXV0aG9yaXphdGlvbigpO1xyXG59KTtcclxuIl19
