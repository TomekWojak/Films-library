import{createElement}from"./helpers.min.js";import{setUserPreference}from"./updateStateFunctions.min.js";const userData=JSON.parse?.(localStorage.getItem("userData"));let profilesCount=userData?.profilesCount||0;const USERNAME="handsomeUser404",PASSWORD="5jksH9d.";export const createLoginHeader=({header:{alt:{logo:e},aria:{logoLink:t,changeLanguageButton:a}}},r,n,o,i)=>{const l=createElement("header",["header"]),s=createElement("a",["header__logo","login-header__logo"],{href:"/","aria-label":`${t}`}),c=createElement("img",["header__logo-img","login-header__logo-img"],{src:"./src/icons/logo.svg",alt:`${e}`,width:"24",height:"24"}),d=createElement("span",["header__logo-text","login-header__logo-text"]);d.textContent="Stream",s.append(c,d),l.append(s);const p=createElement("button",["login-header__lang-select"],{"aria-label":`${a}`}),m=createElement("span",["login-header__lang-platform-lang"]),u=createElement("img",["login-header__lang-arrow"],{src:"./src/icons/chevron-down.svg",alt:"",width:"24",height:"24"}),f=createElement("ul",["login-header__lang-list"]);for(let e=0;e<r;e++){const t=createElement("li",["login-header__lang-choice"],{tabindex:0}),a=Object.keys(n)[e],r=Object.values(n)[e];t.dataset.lang=a,t.textContent=r,t.style.animationDelay=100*e+"ms",f.append(t)}return m.textContent=n[o],p.addEventListener("click",e=>{i.call(p,e,m)}),p.append(m,u,f),l.append(p),l};export const createLoginPage=({main:{text:{title:e,subtitle:t,description:a,button:r},placeholder:{username:n,password:o}}})=>{const i=createElement("main",["main"]),l=createElement("div",["wrapper"]),s=createElement("h1"),c=createElement("span",["main__title"]),d=createElement("span",["main__subtitle"]),p=createElement("p",["main__text"]),m=createElement("form",["main__form"]),u=createElement("input",["main__form-input","main__form-input--username"],{type:"text",placeholder:n}),f=createElement("input",["main__form-input","main__form-input--password"],{type:"password",placeholder:o}),g=createElement("button",["main__form-button"],{type:"submit"}),_=createElement("span",["main__form-button-text"]),h=createElement("p",["main__form-error-txt"]);return c.textContent=e,d.textContent=t,p.textContent=a,_.textContent=r,s.append(c,d),g.append(_),m.append(u,f,g,h),l.append(s,p,m),i.append(l),g.addEventListener("click",e=>{const t=JSON.parse?.(localStorage.getItem("userData"));handleLoginValidation(e,u,f,translations.main.text.errorRequired,translations.main.text.errorInvalid,USERNAME,PASSWORD,h)||(h.classList.remove("visible"),e.target.append(showSmallLoader()),e.target.disabled=!0,setTimeout(()=>{e.target.disabled=!1,hideSmallLoader(),setUserPreference("translations",translations,t),setUserPreference("loggedIn",!0,t),window.location.href="profiles.html"},3e3))}),i};const handleLoginValidation=(e,t,a,r,n,o,i,l)=>(e.preventDefault(),""===t.value.trim()||""===a.value.trim()?(l.classList.add("visible"),l.textContent=r,r):t.value.trim()!==o||a.value.trim()!==i?(e.target.disabled=!0,e.target.append(showSmallLoader()),l.classList.remove("visible"),setTimeout(()=>{l.classList.add("visible"),l.textContent=n,e.target.disabled=!1,hideSmallLoader()},3e3),n):null);export const showBigLoader=()=>{const e=createElement("div",["loading-area"]);return e.innerHTML='            <svg class="loader-big" viewBox="0 0 120 120" width="120" height="120">\n                <defs>\n                    <linearGradient id="loader-accent" x1="0%" y1="0%" x2="100%" y2="0%">\n                        <stop offset="0%" stop-color="#4da8da" stop-opacity="0.8" />\n                        <stop offset="70%" stop-color="#4da8da" stop-opacity="0.4" />\n                        <stop offset="100%" stop-color="#4da8da" stop-opacity="0" />\n                    </linearGradient>\n                </defs>\n                <circle class="loading-circle-big" r="35" cx="60" cy="60"></circle>\n            </svg>',e};export const hideBigLoader=()=>{const e=document.querySelector(".loading-area");e?.remove()};export const showSmallLoader=()=>{const e=createElement("div",["loading-area-small"]);return e.innerHTML='<svg class="loader-small" viewBox="0 0 120 120" width="120" height="120">\n                <defs>\n                    <linearGradient id="loader-accent-small" x1="0%" y1="0%" x2="100%" y2="0%">\n                        <stop offset="0%" stop-color="white" stop-opacity="0.8" />\n                        <stop offset="70%" stop-color="white" stop-opacity="0.3" />\n                        <stop offset="100%" stop-color="white" stop-opacity="0" />\n                    </linearGradient>\n                </defs>\n                <circle class="loading-circle-small" r="12" cx="60" cy="60"></circle>\n            </svg>',e};export const hideSmallLoader=()=>{document.querySelector(".loading-area-small").remove()};export const createProfilesPage=({profiles:{text:{title:e,addProfileInfo:t},aria:{addProfileBtn:a,userProfileBtn:r,userBtnCustomize:n}}})=>{const o=JSON.parse?.(localStorage.getItem("userData")),i=o?.userProfiles,l=document.querySelector(".container"),s=createElement("main",["main-profiles"]),c=createElement("div",["wrapper"]),d=createElement("h1",["main__title","main-profiles__title"]),p=createElement("div",["main-profiles__box"]);if(d.textContent=e,i&&0!==Object.keys(i).length)for(const e in i)p.append(createProfile(r,n,n));p.append(createProfileAddBtn(a,t,r,p,n,n)),c.append(d,p),s.append(c),l.append(s)};const createProfile=(e,t,a)=>{const r=JSON.parse?.(localStorage.getItem("userData")),n=r?.userProfiles||[];let o;if(3==profilesCount||3===n.length)return;profilesCount++,o=["#dc4a34","#062E63","#FAC044"][profilesCount];const i=createElement("div",["main-profiles__profile"]),l=createElement("div",["main-profiles__avatar"]),s=createElement("button",["main-profiles__btn"],{"aria-label":e,"data-id":`user-profile-${profilesCount}`}),c=createElement("div",["main-profiles__user-info"]),d=createElement("input",["main-profiles__name"],{type:"text",readonly:!0,value:n[`user-profile-${profilesCount}`]||`Handsome User ${profilesCount}`}),p=createElement("button",["main-profiles__edit-name"],{"aria-label":t}),m=createElement("img",["main-profiles__edit-icon"],{width:"24",height:"24",loading:"lazy",alt:"",src:"./src/icons/edit.svg"});if(s.innerHTML='<svg class="main-profiles__img" width="150" height="150" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">\n\t<circle cx="70" cy="70" r="8" fill="white" />\n\t<circle cx="130" cy="70" r="8" fill="white" />\n\t<path d="M60 110 Q100 150 140 110" stroke="white" stroke-width="6"\n\tfill="transparent" stroke-linecap="round" />\n\t</svg>',s.style.backgroundColor=o,l.append(s),p.append(m),c.append(d,p),i.append(l,c),!n[`user-profile-${profilesCount}`]){const e={...n,[`user-profile-${profilesCount}`]:`Handsome User ${profilesCount}`};setUserPreference("userProfiles",e,r)}return p.addEventListener("click",e=>{editUsername(e,c,a)}),d.addEventListener("keydown",e=>{"Enter"===e.key&&saveUsername(e)}),i},createProfileAddBtn=(e,t,a,r,n,o)=>{const i=createElement("div",["main-profiles__add-profile"]),l=createElement("div",["main-profiles__avatar"]),s=createElement("button",["main-profiles__btn","main-profiles__btn--add-profile"],{"aria-label":e}),c=createElement("img",["main-profiles__add-img"],{src:"./src/icons/add-profile.svg",loading:"lazy",alt:""}),d=createElement("span",["main-profiles__name"]);return d.textContent=t,s.append(c),l.append(s),i.append(l,d),s.addEventListener("click",()=>{const e=createProfile(a,n,o);e?r.append(e):showErrorPopup("Osiągnięto maksymalną ilość profilów!","#dc4a34")}),i},editUsername=(e,t,a)=>{resetStateOfEditing(e);const r=e.target,n=r.previousElementSibling,o=createSaveBtn(a);r.classList.add("hidden"),o.classList.remove("hidden"),t.append(o),n.focus(),n.select(),n.removeAttribute("readonly"),n.classList.add("focused"),o.addEventListener("click",e=>{saveUsername(e)})},saveUsername=e=>{const t=JSON.parse?.(localStorage.getItem("userData")),a=t?.userProfiles||[],r=e.target.closest(".main-profiles__profile"),n=r.querySelector(".main-profiles__btn").dataset.id,o=r.querySelector(".main-profiles__name");if(""===o.value.trim())return showErrorPopup("Pole nie może być puste","#FAC044");const i={...a,[n]:o.value};setUserPreference("userProfiles",i,t),resetStateOfEditing(e)},createSaveBtn=e=>{const t=createElement("button",["main-profiles__save-name","hidden"],{"aria-label":e}),a=createElement("img",["main-profiles__save-icon"],{width:"24",height:"24",loading:"lazy",alt:"",src:"./src/icons/save.svg"});return t.append(a),t},resetStateOfEditing=e=>{const t=document.querySelectorAll(".focused"),a=document.querySelectorAll(".main-profiles__save-name"),r=document.querySelectorAll(".main-profiles__edit-name");t.forEach(e=>{e.setAttribute("readonly",!0),e.classList.remove("focused"),e.blur()}),a.forEach(e=>e.classList.add("hidden")),r.forEach(e=>e.classList.remove("hidden"))};let popupVisible=!1;const showErrorPopup=(e,t)=>{if(popupVisible)return;popupVisible=!0;const a=document.documentElement,r=document.querySelector(".container"),n=createElement("div",["error-popup"]),o=createElement("p",["error-popup__text"]);o.textContent=e,a.style.setProperty("--errorTxtColor",t),n.append(o),r.append(n),setTimeout(()=>{n.classList.add("hidden")},2e3),setTimeout(()=>{n.remove(),popupVisible=!1},2500)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50cy5taW4uanMiLCJuYW1lcyI6WyJjcmVhdGVFbGVtZW50Iiwic2V0VXNlclByZWZlcmVuY2UiLCJ1c2VyRGF0YSIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJwcm9maWxlc0NvdW50IiwiVVNFUk5BTUUiLCJQQVNTV09SRCIsImNyZWF0ZUxvZ2luSGVhZGVyIiwiaGVhZGVyIiwiYWx0IiwibG9nbyIsImFyaWEiLCJsb2dvTGluayIsImNoYW5nZUxhbmd1YWdlQnV0dG9uIiwibGFuZ0Ftb3VudCIsImxhbmdOYW1lcyIsImxhbmd1YWdlIiwiaGFuZGxlTGFuZ1NlbGVjdCIsInBhZ2VMb2dvIiwiaHJlZiIsImxvZ29JbWciLCJzcmMiLCJ3aWR0aCIsImhlaWdodCIsImxvZ29UZXh0IiwidGV4dENvbnRlbnQiLCJhcHBlbmQiLCJsYW5nU2VsZWN0IiwibGFuZ1BsYXRmb3JtTGFuZyIsImxhbmdBcnJvdyIsImxhbmdMaXN0IiwiaSIsImxhbmdDaG9pY2UiLCJ0YWJpbmRleCIsImRhdGEiLCJPYmplY3QiLCJrZXlzIiwidGV4dCIsInZhbHVlcyIsImRhdGFzZXQiLCJsYW5nIiwic3R5bGUiLCJhbmltYXRpb25EZWxheSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY2FsbCIsImNyZWF0ZUxvZ2luUGFnZSIsIm1haW4iLCJ0aXRsZSIsInN1YnRpdGxlIiwiZGVzY3JpcHRpb24iLCJidXR0b24iLCJwbGFjZWhvbGRlciIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJtYWluQ29udGVudCIsIndyYXBwZXIiLCJsb2dpblRpdGxlIiwibG9naW5UaXRsZVRvcCIsImxvZ2luVGl0bGVCb3R0b20iLCJsb2dpblRleHQiLCJmb3JtIiwidXNlcm5hbWVJbnB1dCIsInR5cGUiLCJwYXNzd29yZElucHV0Iiwic3VibWl0QnRuIiwiYnV0dG9uVGV4dCIsImVycm9yVHh0IiwiaGFuZGxlTG9naW5WYWxpZGF0aW9uIiwidHJhbnNsYXRpb25zIiwiZXJyb3JSZXF1aXJlZCIsImVycm9ySW52YWxpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRhcmdldCIsInNob3dTbWFsbExvYWRlciIsImRpc2FibGVkIiwic2V0VGltZW91dCIsImhpZGVTbWFsbExvYWRlciIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVxdWlyZUVycm9yIiwiaW52YWxpZEVycm9yIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInRyaW0iLCJhZGQiLCJzaG93QmlnTG9hZGVyIiwibG9hZGluZ0FyZWEiLCJpbm5lckhUTUwiLCJoaWRlQmlnTG9hZGVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlUHJvZmlsZXNQYWdlIiwicHJvZmlsZXMiLCJhZGRQcm9maWxlSW5mbyIsImFkZFByb2ZpbGVCdG4iLCJ1c2VyUHJvZmlsZUJ0biIsInVzZXJCdG5DdXN0b21pemUiLCJ1c2VyUHJvZmlsZXNMaXN0IiwidXNlclByb2ZpbGVzIiwiY29udGFpbmVyIiwicHJvZmlsZXNQYWdlTWFpbiIsInByb2ZpbGVzVGl0bGUiLCJwcm9maWxlc0JveCIsImxlbmd0aCIsImtleSIsImNyZWF0ZVByb2ZpbGUiLCJjcmVhdGVQcm9maWxlQWRkQnRuIiwiYXJpYUluZm8iLCJ1c2VyQnRuSW5mbyIsInNhdmVCdG5BcmlhIiwiZXhpc3RpbmdQcm9maWxlcyIsImNvbG9yIiwidXNlclByb2ZpbGUiLCJ1c2VyQXZhdGFyQm94IiwidXNlclByb2ZpbGVJbmZvQm94IiwidXNlclByb2ZpbGVJbmZvIiwicmVhZG9ubHkiLCJlZGl0VXNlckluZm9CdG4iLCJlZGl0VXNlckluZm9JY29uIiwibG9hZGluZyIsImJhY2tncm91bmRDb2xvciIsInVwZGF0ZWRQcm9maWxlcyIsImVkaXRVc2VybmFtZSIsInNhdmVVc2VybmFtZSIsImluZm8iLCJ1c2VyQnRuQXJpYSIsImFkZFByb2ZpbGVCb3giLCJhZGRQcm9maWxlQXZhdGFyIiwiYWRkUHJvZmlsZVBsdXNJY29uIiwicHJvZmlsZSIsInNob3dFcnJvclBvcHVwIiwicGFyZW50IiwicmVzZXRTdGF0ZU9mRWRpdGluZyIsImVkaXRCdG4iLCJuYW1lVG9FZGl0IiwicHJldmlvdXNFbGVtZW50U2libGluZyIsInNhdmVCdG4iLCJjcmVhdGVTYXZlQnRuIiwiZm9jdXMiLCJzZWxlY3QiLCJyZW1vdmVBdHRyaWJ1dGUiLCJjbG9zZXN0UHJvZmlsZSIsImNsb3Nlc3QiLCJjbG9zZXN0UHJvZmlsZUlkIiwiaWQiLCJjbG9zZXN0UHJvZmlsZU5hbWUiLCJzYXZlVXNlckluZm9CdG4iLCJzYXZlVXNlckluZm9JY29uIiwiZm9jdXNlZE5hbWVzIiwicXVlcnlTZWxlY3RvckFsbCIsImFsbFNhdmVCdG5zIiwiYWxsRWRpdEJ0bnMiLCJmb3JFYWNoIiwiZWwiLCJzZXRBdHRyaWJ1dGUiLCJibHVyIiwiYnRuIiwicG9wdXBWaXNpYmxlIiwicm9vdCIsImRvY3VtZW50RWxlbWVudCIsInBvcHVwIiwicG9wdXBFcnJvciIsInNldFByb3BlcnR5Il0sInNvdXJjZXMiOlsiY29tcG9uZW50cy5qcyJdLCJtYXBwaW5ncyI6Ik9BQVNBLGtCQUFxQiwwQkFDckJDLHNCQUF5QixnQ0FDbEMsTUFBTUMsU0FBV0MsS0FBS0MsUUFBUUMsYUFBYUMsUUFBUSxhQUVuRCxJQUFJQyxjQUFnQkwsVUFBVUssZUFBaUIsRUFDL0MsTUFBTUMsU0FBVyxrQkFDWEMsU0FBVyxrQkFFVixNQUFNQyxrQkFBb0IsRUFFL0JDLFFBQ0NDLEtBQU9DLFFBQ1BDLE1BQVFDLFdBQVVDLDBCQUdwQkMsRUFDQUMsRUFDQUMsRUFDQUMsS0FHQSxNQUFNVCxFQUFTWCxjQUFjLFNBQVUsQ0FBQyxXQUNsQ3FCLEVBQVdyQixjQUFjLElBQUssQ0FBQyxlQUFnQixzQkFBdUIsQ0FDM0VzQixLQUFNLElBQ04sYUFBYyxHQUFHUCxNQUVaUSxFQUFVdkIsY0FDZixNQUNBLENBQUMsbUJBQW9CLDBCQUNyQixDQUNDd0IsSUFBSyx1QkFDTFosSUFBSyxHQUFHQyxJQUNSWSxNQUFPLEtBQ1BDLE9BQVEsT0FHSkMsRUFBVzNCLGNB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LENBQUUsYUFBY2tILElBRVhzQyxFQUFtQnhKLGNBQWMsTUFBTyxDQUFDLDRCQUE2QixDQUMzRXlCLE1BQU8sS0FDUEMsT0FBUSxLQUNSa0csUUFBUyxPQUNUaEgsSUFBSyxHQUNMWSxJQUFLLHlCQUtOLE9BRkErSCxFQUFnQjFILE9BQU8ySCxHQUVoQkQsR0FHRmQsb0JBQXVCMUYsSUFDNUIsTUFBTTBHLEVBQWUzRCxTQUFTNEQsaUJBQWlCLFlBQ3pDQyxFQUFjN0QsU0FBUzRELGlCQUFpQiw2QkFDeENFLEVBQWM5RCxTQUFTNEQsaUJBQWlCLDZCQUU5Q0QsRUFBYUksUUFBU0MsSUFDckJBLEVBQUdDLGFBQWEsWUFBWSxHQUM1QkQsRUFBR25GLFVBQVVDLE9BQU8sV0FDcEJrRixFQUFHRSxTQUVKTCxFQUFZRSxRQUFTSSxHQUFRQSxFQUFJdEYsVUFBVWMsSUFBSSxXQUMvQ21FLEVBQVlDLFFBQVNJLEdBQVFBLEVBQUl0RixVQUFVQyxPQUFPLFlBR25ELElBQUlzRixjQUFlLEVBQ25CLE1BQU0zQixlQUFpQixDQUFDL0YsRUFBTTRFLEtBQzdCLEdBQUk4QyxhQUFjLE9BQ2xCQSxjQUFlLEVBRWYsTUFBTUMsRUFBT3JFLFNBQVNzRSxnQkFDaEI1RCxFQUFZVixTQUFTQyxjQUFjLGNBRW5Dc0UsRUFBUXJLLGNBQWMsTUFBTyxDQUFDLGdCQUM5QnNLLEVBQWF0SyxjQUFjLElBQUssQ0FBQyxzQkFFdkNzSyxFQUFXMUksWUFBY1ksRUFDekIySCxFQUFLdkgsTUFBTTJILFlBQVksa0JBQW1CbkQsR0FFMUNpRCxFQUFNeEksT0FBT3lJLEdBQ2I5RCxFQUFVM0UsT0FBT3dJLEdBRWpCckYsV0FBVyxLQUNWcUYsRUFBTTFGLFVBQVVjLElBQUksV0FDbEIsS0FDSFQsV0FBVyxLQUNWcUYsRUFBTXpGLFNBQ05zRixjQUFlLEdBQ2IiLCJpZ25vcmVMaXN0IjpbXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlRWxlbWVudCB9IGZyb20gXCIuL2hlbHBlcnMubWluLmpzXCI7XHJcbmltcG9ydCB7IHNldFVzZXJQcmVmZXJlbmNlIH0gZnJvbSBcIi4vdXBkYXRlU3RhdGVGdW5jdGlvbnMubWluLmpzXCI7XHJcbmNvbnN0IHVzZXJEYXRhID0gSlNPTi5wYXJzZT8uKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlckRhdGFcIikpO1xyXG5cclxubGV0IHByb2ZpbGVzQ291bnQgPSB1c2VyRGF0YT8ucHJvZmlsZXNDb3VudCB8fCAwO1xyXG5jb25zdCBVU0VSTkFNRSA9IFwiaGFuZHNvbWVVc2VyNDA0XCI7XHJcbmNvbnN0IFBBU1NXT1JEID0gXCI1amtzSDlkLlwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUxvZ2luSGVhZGVyID0gKFxyXG5cdHtcclxuXHRcdGhlYWRlcjoge1xyXG5cdFx0XHRhbHQ6IHsgbG9nbyB9LFxyXG5cdFx0XHRhcmlhOiB7IGxvZ29MaW5rLCBjaGFuZ2VMYW5ndWFnZUJ1dHRvbiB9LFxyXG5cdFx0fSxcclxuXHR9LFxyXG5cdGxhbmdBbW91bnQsXHJcblx0bGFuZ05hbWVzLFxyXG5cdGxhbmd1YWdlLFxyXG5cdGhhbmRsZUxhbmdTZWxlY3RcclxuKSA9PiB7XHJcblx0Ly8gbG9nb1xyXG5cdGNvbnN0IGhlYWRlciA9IGNyZWF0ZUVsZW1lbnQoXCJoZWFkZXJcIiwgW1wiaGVhZGVyXCJdKTtcclxuXHRjb25zdCBwYWdlTG9nbyA9IGNyZWF0ZUVsZW1lbnQoXCJhXCIsIFtcImhlYWRlcl9fbG9nb1wiLCBcImxvZ2luLWhlYWRlcl9fbG9nb1wiXSwge1xyXG5cdFx0aHJlZjogXCIvXCIsXHJcblx0XHRcImFyaWEtbGFiZWxcIjogYCR7bG9nb0xpbmt9YCxcclxuXHR9KTtcclxuXHRjb25zdCBsb2dvSW1nID0gY3JlYXRlRWxlbWVudChcclxuXHRcdFwiaW1nXCIsXHJcblx0XHRbXCJoZWFkZXJfX2xvZ28taW1nXCIsIFwibG9naW4taGVhZGVyX19sb2dvLWltZ1wiXSxcclxuXHRcdHtcclxuXHRcdFx0c3JjOiBcIi4vc3JjL2ljb25zL2xvZ28uc3ZnXCIsXHJcblx0XHRcdGFsdDogYCR7bG9nb31gLFxyXG5cdFx0XHR3aWR0aDogXCIyNFwiLFxyXG5cdFx0XHRoZWlnaHQ6IFwiMjRcIixcclxuXHRcdH1cclxuXHQpO1xyXG5cdGNvbnN0IGxvZ29UZXh0ID0gY3JlYXRlRWxlbWVudChcInNwYW5cIiwgW1xyXG5cdFx0XCJoZWFkZXJfX2xvZ28tdGV4dFwiLFxyXG5cdFx0XCJsb2dpbi1oZWFkZXJfX2xvZ28tdGV4dFwiLFxyXG5cdF0pO1xyXG5cdGxvZ29UZXh0LnRleHRDb250ZW50ID0gXCJTdHJlYW1cIjtcclxuXHRwYWdlTG9nby5hcHBlbmQobG9nb0ltZywgbG9nb1RleHQpO1xyXG5cdGhlYWRlci5hcHBlbmQocGFnZUxvZ28pO1xyXG5cdC8vIGVuZCBvZiBsb2dvXHJcblxyXG5cdC8vIGxhbmd1YWdlIHNlbGVjdG9yXHJcblx0Y29uc3QgbGFuZ1NlbGVjdCA9IGNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgW1wibG9naW4taGVhZGVyX19sYW5nLXNlbGVjdFwiXSwge1xyXG5cdFx0XCJhcmlhLWxhYmVsXCI6IGAke2NoYW5nZUxhbmd1YWdlQnV0dG9ufWAsXHJcblx0fSk7XHJcblx0Y29uc3QgbGFuZ1BsYXRmb3JtTGFuZyA9IGNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIFtcclxuXHRcdFwibG9naW4taGVhZGVyX19sYW5nLXBsYXRmb3JtLWxhbmdcIixcclxuXHRdKTtcclxuXHRjb25zdCBsYW5nQXJyb3cgPSBjcmVhdGVFbGVtZW50KFwiaW1nXCIsIFtcImxvZ2luLWhlYWRlcl9fbGFuZy1hcnJvd1wiXSwge1xyXG5cdFx0c3JjOiBcIi4vc3JjL2ljb25zL2NoZXZyb24tZG93bi5zdmdcIixcclxuXHRcdGFsdDogXCJcIixcclxuXHRcdHdpZHRoOiBcIjI0XCIsXHJcblx0XHRoZWlnaHQ6IFwiMjRcIixcclxuXHR9KTtcclxuXHRjb25zdCBsYW5nTGlzdCA9IGNyZWF0ZUVsZW1lbnQoXCJ1bFwiLCBbXCJsb2dpbi1oZWFkZXJfX2xhbmctbGlzdFwiXSk7XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbGFuZ0Ftb3VudDsgaSsrKSB7XHJcblx0XHRjb25zdCBsYW5nQ2hvaWNlID0gY3JlYXRlRWxlbWVudChcImxpXCIsIFtcImxvZ2luLWhlYWRlcl9fbGFuZy1jaG9pY2VcIl0sIHtcclxuXHRcdFx0dGFiaW5kZXg6IDAsXHJcblx0XHR9KTtcclxuXHRcdGNvbnN0IGRhdGEgPSBPYmplY3Qua2V5cyhsYW5nTmFtZXMpW2ldO1xyXG5cdFx0Y29uc3QgdGV4dCA9IE9iamVjdC52YWx1ZXMobGFuZ05hbWVzKVtpXTtcclxuXHJcblx0XHRsYW5nQ2hvaWNlLmRhdGFzZXQubGFuZyA9IGRhdGE7XHJcblx0XHRsYW5nQ2hvaWNlLnRleHRDb250ZW50ID0gdGV4dDtcclxuXHRcdGxhbmdDaG9pY2Uuc3R5bGUuYW5pbWF0aW9uRGVsYXkgPSBpICogMTAwICsgXCJtc1wiO1xyXG5cdFx0bGFuZ0xpc3QuYXBwZW5kKGxhbmdDaG9pY2UpO1xyXG5cdH1cclxuXHJcblx0bGFuZ1BsYXRmb3JtTGFuZy50ZXh0Q29udGVudCA9IGxhbmdOYW1lc1tsYW5ndWFnZV07XHJcblxyXG5cdGxhbmdTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcblx0XHRoYW5kbGVMYW5nU2VsZWN0LmNhbGwobGFuZ1NlbGVjdCwgZSwgbGFuZ1BsYXRmb3JtTGFuZyk7XHJcblx0fSk7XHJcblxyXG5cdGxhbmdTZWxlY3QuYXBwZW5kKGxhbmdQbGF0Zm9ybUxhbmcsIGxhbmdBcnJvdywgbGFuZ0xpc3QpO1xyXG5cdGhlYWRlci5hcHBlbmQobGFuZ1NlbGVjdCk7XHJcblxyXG5cdHJldHVybiBoZWFkZXI7XHJcblx0Ly8gZW5kIG9mIGxhbmd1YWdlIHNlbGVjdG9yXHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlTG9naW5QYWdlID0gKHtcclxuXHRtYWluOiB7XHJcblx0XHR0ZXh0OiB7IHRpdGxlLCBzdWJ0aXRsZSwgZGVzY3JpcHRpb24sIGJ1dHRvbiB9LFxyXG5cdFx0cGxhY2Vob2xkZXI6IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0sXHJcblx0fSxcclxufSkgPT4ge1xyXG5cdGNvbnN0IG1haW5Db250ZW50ID0gY3JlYXRlRWxlbWVudChcIm1haW5cIiwgW1wibWFpblwiXSk7XHJcblx0Y29uc3Qgd3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wid3JhcHBlclwiXSk7XHJcblx0Y29uc3QgbG9naW5UaXRsZSA9IGNyZWF0ZUVsZW1lbnQoXCJoMVwiKTtcclxuXHRjb25zdCBsb2dpblRpdGxlVG9wID0gY3JlYXRlRWxlbWVudChcInNwYW5cIiwgW1wibWFpbl9fdGl0bGVcIl0pO1xyXG5cdGNvbnN0IGxvZ2luVGl0bGVCb3R0b20gPSBjcmVhdGVFbGVtZW50KFwic3BhblwiLCBbXCJtYWluX19zdWJ0aXRsZVwiXSk7XHJcblx0Y29uc3QgbG9naW5UZXh0ID0gY3JlYXRlRWxlbWVudChcInBcIiwgW1wibWFpbl9fdGV4dFwiXSk7XHJcblx0Y29uc3QgZm9ybSA9IGNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIsIFtcIm1haW5fX2Zvcm1cIl0pO1xyXG5cdGNvbnN0IHVzZXJuYW1lSW5wdXQgPSBjcmVhdGVFbGVtZW50KFxyXG5cdFx0XCJpbnB1dFwiLFxyXG5cdFx0W1wibWFpbl9fZm9ybS1pbnB1dFwiLCBcIm1haW5fX2Zvcm0taW5wdXQtLXVzZXJuYW1lXCJdLFxyXG5cdFx0eyB0eXBlOiBcInRleHRcIiwgcGxhY2Vob2xkZXI6IHVzZXJuYW1lIH1cclxuXHQpO1xyXG5cdGNvbnN0IHBhc3N3b3JkSW5wdXQgPSBjcmVhdGVFbGVtZW50KFxyXG5cdFx0XCJpbnB1dFwiLFxyXG5cdFx0W1wibWFpbl9fZm9ybS1pbnB1dFwiLCBcIm1haW5fX2Zvcm0taW5wdXQtLXBhc3N3b3JkXCJdLFxyXG5cdFx0eyB0eXBlOiBcInBhc3N3b3JkXCIsIHBsYWNlaG9sZGVyOiBwYXNzd29yZCB9XHJcblx0KTtcclxuXHRjb25zdCBzdWJtaXRCdG4gPSBjcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIFtcIm1haW5fX2Zvcm0tYnV0dG9uXCJdLCB7XHJcblx0XHR0eXBlOiBcInN1Ym1pdFwiLFxyXG5cdH0pO1xyXG5cdGNvbnN0IGJ1dHRvblRleHQgPSBjcmVhdGVFbGVtZW50KFwic3BhblwiLCBbXCJtYWluX19mb3JtLWJ1dHRvbi10ZXh0XCJdKTtcclxuXHJcblx0Y29uc3QgZXJyb3JUeHQgPSBjcmVhdGVFbGVtZW50KFwicFwiLCBbXCJtYWluX19mb3JtLWVycm9yLXR4dFwiXSk7XHJcblx0bG9naW5UaXRsZVRvcC50ZXh0Q29udGVudCA9IHRpdGxlO1xyXG5cdGxvZ2luVGl0bGVCb3R0b20udGV4dENvbnRlbnQgPSBzdWJ0aXRsZTtcclxuXHRsb2dpblRleHQudGV4dENvbnRlbnQgPSBkZXNjcmlwdGlvbjtcclxuXHRidXR0b25UZXh0LnRleHRDb250ZW50ID0gYnV0dG9uO1xyXG5cclxuXHRsb2dpblRpdGxlLmFwcGVuZChsb2dpblRpdGxlVG9wLCBsb2dpblRpdGxlQm90dG9tKTtcclxuXHRzdWJtaXRCdG4uYXBwZW5kKGJ1dHRvblRleHQpO1xyXG5cdGZvcm0uYXBwZW5kKHVzZXJuYW1lSW5wdXQsIHBhc3N3b3JkSW5wdXQsIHN1Ym1pdEJ0biwgZXJyb3JUeHQpO1xyXG5cclxuXHR3cmFwcGVyLmFwcGVuZChsb2dpblRpdGxlLCBsb2dpblRleHQsIGZvcm0pO1xyXG5cdG1haW5Db250ZW50LmFwcGVuZCh3cmFwcGVyKTtcclxuXHJcblx0c3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0Y29uc3QgdXNlckRhdGEgPSBKU09OLnBhcnNlPy4obG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ1c2VyRGF0YVwiKSk7XHJcblxyXG5cdFx0Y29uc3QgcmVzdWx0cyA9IGhhbmRsZUxvZ2luVmFsaWRhdGlvbihcclxuXHRcdFx0ZSxcclxuXHRcdFx0dXNlcm5hbWVJbnB1dCxcclxuXHRcdFx0cGFzc3dvcmRJbnB1dCxcclxuXHRcdFx0dHJhbnNsYXRpb25zLm1haW4udGV4dC5lcnJvclJlcXVpcmVkLFxyXG5cdFx0XHR0cmFuc2xhdGlvbnMubWFpbi50ZXh0LmVycm9ySW52YWxpZCxcclxuXHRcdFx0VVNFUk5BTUUsXHJcblx0XHRcdFBBU1NXT1JELFxyXG5cdFx0XHRlcnJvclR4dFxyXG5cdFx0KTtcclxuXHJcblx0XHRpZiAoIXJlc3VsdHMpIHtcclxuXHRcdFx0ZXJyb3JUeHQuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XHJcblx0XHRcdGUudGFyZ2V0LmFwcGVuZChzaG93U21hbGxMb2FkZXIoKSk7XHJcblx0XHRcdGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTtcclxuXHJcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0XHRcdGUudGFyZ2V0LmRpc2FibGVkID0gZmFsc2U7XHJcblx0XHRcdFx0aGlkZVNtYWxsTG9hZGVyKCk7XHJcblxyXG5cdFx0XHRcdHNldFVzZXJQcmVmZXJlbmNlKFwidHJhbnNsYXRpb25zXCIsIHRyYW5zbGF0aW9ucywgdXNlckRhdGEpO1xyXG5cdFx0XHRcdHNldFVzZXJQcmVmZXJlbmNlKFwibG9nZ2VkSW5cIiwgdHJ1ZSwgdXNlckRhdGEpO1xyXG5cdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCJwcm9maWxlcy5odG1sXCI7IC8vIHByemVqxZtjaWUgbmEgc3Ryb27EmSB6IHByb2ZpbGFtaVxyXG5cdFx0XHR9LCAzMDAwKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIG1haW5Db250ZW50O1xyXG59O1xyXG5cclxuY29uc3QgaGFuZGxlTG9naW5WYWxpZGF0aW9uID0gKFxyXG5cdGUsXHJcblx0dXNlcm5hbWVJbnB1dCxcclxuXHRwYXNzd29yZElucHV0LFxyXG5cdHJlcXVpcmVFcnJvcixcclxuXHRpbnZhbGlkRXJyb3IsXHJcblx0dXNlcm5hbWUsXHJcblx0cGFzc3dvcmQsXHJcblx0ZXJyb3JUeHRcclxuKSA9PiB7XHJcblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRpZiAodXNlcm5hbWVJbnB1dC52YWx1ZS50cmltKCkgPT09IFwiXCIgfHwgcGFzc3dvcmRJbnB1dC52YWx1ZS50cmltKCkgPT09IFwiXCIpIHtcclxuXHRcdGVycm9yVHh0LmNsYXNzTGlzdC5hZGQoXCJ2aXNpYmxlXCIpO1xyXG5cdFx0ZXJyb3JUeHQudGV4dENvbnRlbnQgPSByZXF1aXJlRXJyb3I7XHJcblx0XHRyZXR1cm4gcmVxdWlyZUVycm9yO1xyXG5cdH0gZWxzZSBpZiAoXHJcblx0XHR1c2VybmFtZUlucHV0LnZhbHVlLnRyaW0oKSAhPT0gdXNlcm5hbWUgfHxcclxuXHRcdHBhc3N3b3JkSW5wdXQudmFsdWUudHJpbSgpICE9PSBwYXNzd29yZFxyXG5cdCkge1xyXG5cdFx0ZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xyXG5cdFx0ZS50YXJnZXQuYXBwZW5kKHNob3dTbWFsbExvYWRlcigpKTtcclxuXHRcdGVycm9yVHh0LmNsYXNzTGlzdC5yZW1vdmUoXCJ2aXNpYmxlXCIpO1xyXG5cclxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0XHRlcnJvclR4dC5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcclxuXHRcdFx0ZXJyb3JUeHQudGV4dENvbnRlbnQgPSBpbnZhbGlkRXJyb3I7XHJcblxyXG5cdFx0XHRlLnRhcmdldC5kaXNhYmxlZCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0aGlkZVNtYWxsTG9hZGVyKCk7XHJcblx0XHR9LCAzMDAwKTtcclxuXHRcdHJldHVybiBpbnZhbGlkRXJyb3I7XHJcblx0fSBlbHNlIHtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzaG93QmlnTG9hZGVyID0gKCkgPT4ge1xyXG5cdGNvbnN0IGxvYWRpbmdBcmVhID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJsb2FkaW5nLWFyZWFcIl0pO1xyXG5cdGxvYWRpbmdBcmVhLmlubmVySFRNTCA9IGAgICAgICAgICAgICA8c3ZnIGNsYXNzPVwibG9hZGVyLWJpZ1wiIHZpZXdCb3g9XCIwIDAgMTIwIDEyMFwiIHdpZHRoPVwiMTIwXCIgaGVpZ2h0PVwiMTIwXCI+XHJcbiAgICAgICAgICAgICAgICA8ZGVmcz5cclxuICAgICAgICAgICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9XCJsb2FkZXItYWNjZW50XCIgeDE9XCIwJVwiIHkxPVwiMCVcIiB4Mj1cIjEwMCVcIiB5Mj1cIjAlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD1cIjAlXCIgc3RvcC1jb2xvcj1cIiM0ZGE4ZGFcIiBzdG9wLW9wYWNpdHk9XCIwLjhcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9XCI3MCVcIiBzdG9wLWNvbG9yPVwiIzRkYThkYVwiIHN0b3Atb3BhY2l0eT1cIjAuNFwiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD1cIjEwMCVcIiBzdG9wLWNvbG9yPVwiIzRkYThkYVwiIHN0b3Atb3BhY2l0eT1cIjBcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+XHJcbiAgICAgICAgICAgICAgICA8L2RlZnM+XHJcbiAgICAgICAgICAgICAgICA8Y2lyY2xlIGNsYXNzPVwibG9hZGluZy1jaXJjbGUtYmlnXCIgcj1cIjM1XCIgY3g9XCI2MFwiIGN5PVwiNjBcIj48L2NpcmNsZT5cclxuICAgICAgICAgICAgPC9zdmc+YDtcclxuXHRyZXR1cm4gbG9hZGluZ0FyZWE7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBoaWRlQmlnTG9hZGVyID0gKCkgPT4ge1xyXG5cdGNvbnN0IGxvYWRpbmdBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5sb2FkaW5nLWFyZWFcIik7XHJcblx0bG9hZGluZ0FyZWE/LnJlbW92ZSgpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNob3dTbWFsbExvYWRlciA9ICgpID0+IHtcclxuXHRjb25zdCBsb2FkaW5nQXJlYSA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibG9hZGluZy1hcmVhLXNtYWxsXCJdKTtcclxuXHRsb2FkaW5nQXJlYS5pbm5lckhUTUwgPSBgPHN2ZyBjbGFzcz1cImxvYWRlci1zbWFsbFwiIHZpZXdCb3g9XCIwIDAgMTIwIDEyMFwiIHdpZHRoPVwiMTIwXCIgaGVpZ2h0PVwiMTIwXCI+XHJcbiAgICAgICAgICAgICAgICA8ZGVmcz5cclxuICAgICAgICAgICAgICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9XCJsb2FkZXItYWNjZW50LXNtYWxsXCIgeDE9XCIwJVwiIHkxPVwiMCVcIiB4Mj1cIjEwMCVcIiB5Mj1cIjAlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD1cIjAlXCIgc3RvcC1jb2xvcj1cIndoaXRlXCIgc3RvcC1vcGFjaXR5PVwiMC44XCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHN0b3Agb2Zmc2V0PVwiNzAlXCIgc3RvcC1jb2xvcj1cIndoaXRlXCIgc3RvcC1vcGFjaXR5PVwiMC4zXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHN0b3Agb2Zmc2V0PVwiMTAwJVwiIHN0b3AtY29sb3I9XCJ3aGl0ZVwiIHN0b3Atb3BhY2l0eT1cIjBcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvbGluZWFyR3JhZGllbnQ+XHJcbiAgICAgICAgICAgICAgICA8L2RlZnM+XHJcbiAgICAgICAgICAgICAgICA8Y2lyY2xlIGNsYXNzPVwibG9hZGluZy1jaXJjbGUtc21hbGxcIiByPVwiMTJcIiBjeD1cIjYwXCIgY3k9XCI2MFwiPjwvY2lyY2xlPlxyXG4gICAgICAgICAgICA8L3N2Zz5gO1xyXG5cclxuXHRyZXR1cm4gbG9hZGluZ0FyZWE7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBoaWRlU21hbGxMb2FkZXIgPSAoKSA9PiB7XHJcblx0Y29uc3QgbG9hZGluZ0FyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxvYWRpbmctYXJlYS1zbWFsbFwiKTtcclxuXHRsb2FkaW5nQXJlYS5yZW1vdmUoKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVQcm9maWxlc1BhZ2UgPSAoe1xyXG5cdHByb2ZpbGVzOiB7XHJcblx0XHR0ZXh0OiB7IHRpdGxlLCBhZGRQcm9maWxlSW5mbyB9LFxyXG5cdFx0YXJpYTogeyBhZGRQcm9maWxlQnRuLCB1c2VyUHJvZmlsZUJ0biwgdXNlckJ0bkN1c3RvbWl6ZSB9LFxyXG5cdH0sXHJcbn0pID0+IHtcclxuXHRjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2U/Lihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuXHRjb25zdCB1c2VyUHJvZmlsZXNMaXN0ID0gdXNlckRhdGE/LnVzZXJQcm9maWxlcztcclxuXHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jb250YWluZXJcIik7XHJcblx0Y29uc3QgcHJvZmlsZXNQYWdlTWFpbiA9IGNyZWF0ZUVsZW1lbnQoXCJtYWluXCIsIFtcIm1haW4tcHJvZmlsZXNcIl0pO1xyXG5cdGNvbnN0IHdyYXBwZXIgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcIndyYXBwZXJcIl0pO1xyXG5cdGNvbnN0IHByb2ZpbGVzVGl0bGUgPSBjcmVhdGVFbGVtZW50KFwiaDFcIiwgW1xyXG5cdFx0XCJtYWluX190aXRsZVwiLFxyXG5cdFx0XCJtYWluLXByb2ZpbGVzX190aXRsZVwiLFxyXG5cdF0pO1xyXG5cdGNvbnN0IHByb2ZpbGVzQm94ID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJtYWluLXByb2ZpbGVzX19ib3hcIl0pO1xyXG5cclxuXHRwcm9maWxlc1RpdGxlLnRleHRDb250ZW50ID0gdGl0bGU7XHJcblxyXG5cdGlmICh1c2VyUHJvZmlsZXNMaXN0ICYmIE9iamVjdC5rZXlzKHVzZXJQcm9maWxlc0xpc3QpLmxlbmd0aCAhPT0gMCkge1xyXG5cdFx0Zm9yIChjb25zdCBrZXkgaW4gdXNlclByb2ZpbGVzTGlzdCkge1xyXG5cdFx0XHRwcm9maWxlc0JveC5hcHBlbmQoXHJcblx0XHRcdFx0Y3JlYXRlUHJvZmlsZSh1c2VyUHJvZmlsZUJ0biwgdXNlckJ0bkN1c3RvbWl6ZSwgdXNlckJ0bkN1c3RvbWl6ZSlcclxuXHRcdFx0KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHByb2ZpbGVzQm94LmFwcGVuZChcclxuXHRcdGNyZWF0ZVByb2ZpbGVBZGRCdG4oXHJcblx0XHRcdGFkZFByb2ZpbGVCdG4sXHJcblx0XHRcdGFkZFByb2ZpbGVJbmZvLFxyXG5cdFx0XHR1c2VyUHJvZmlsZUJ0bixcclxuXHRcdFx0cHJvZmlsZXNCb3gsXHJcblx0XHRcdHVzZXJCdG5DdXN0b21pemUsXHJcblx0XHRcdHVzZXJCdG5DdXN0b21pemVcclxuXHRcdClcclxuXHQpO1xyXG5cdHdyYXBwZXIuYXBwZW5kKHByb2ZpbGVzVGl0bGUsIHByb2ZpbGVzQm94KTtcclxuXHRwcm9maWxlc1BhZ2VNYWluLmFwcGVuZCh3cmFwcGVyKTtcclxuXHJcblx0Y29udGFpbmVyLmFwcGVuZChwcm9maWxlc1BhZ2VNYWluKTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZVByb2ZpbGUgPSAoYXJpYUluZm8sIHVzZXJCdG5JbmZvLCBzYXZlQnRuQXJpYSkgPT4ge1xyXG5cdGNvbnN0IHVzZXJEYXRhID0gSlNPTi5wYXJzZT8uKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlckRhdGFcIikpO1xyXG5cdGNvbnN0IGV4aXN0aW5nUHJvZmlsZXMgPSB1c2VyRGF0YT8udXNlclByb2ZpbGVzIHx8IFtdO1xyXG5cclxuXHRsZXQgY29sb3I7XHJcblxyXG5cdGNvbnN0IGNvbG9ycyA9IFtcIiNkYzRhMzRcIiwgXCIjMDYyRTYzXCIsIFwiI0ZBQzA0NFwiXTtcclxuXHJcblx0aWYgKHByb2ZpbGVzQ291bnQgPT0gMyB8fCBleGlzdGluZ1Byb2ZpbGVzLmxlbmd0aCA9PT0gMykgcmV0dXJuO1xyXG5cclxuXHRwcm9maWxlc0NvdW50Kys7XHJcblx0Y29sb3IgPSBjb2xvcnNbcHJvZmlsZXNDb3VudF07XHJcblxyXG5cdGNvbnN0IHVzZXJQcm9maWxlID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJtYWluLXByb2ZpbGVzX19wcm9maWxlXCJdKTtcclxuXHRjb25zdCB1c2VyQXZhdGFyQm94ID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJtYWluLXByb2ZpbGVzX19hdmF0YXJcIl0pO1xyXG5cdGNvbnN0IHVzZXJQcm9maWxlQnRuID0gY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCBbXCJtYWluLXByb2ZpbGVzX19idG5cIl0sIHtcclxuXHRcdFwiYXJpYS1sYWJlbFwiOiBhcmlhSW5mbyxcclxuXHRcdFwiZGF0YS1pZFwiOiBgdXNlci1wcm9maWxlLSR7cHJvZmlsZXNDb3VudH1gLFxyXG5cdH0pO1xyXG5cclxuXHRjb25zdCB1c2VyUHJvZmlsZUluZm9Cb3ggPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcIm1haW4tcHJvZmlsZXNfX3VzZXItaW5mb1wiXSk7XHJcblx0Y29uc3QgdXNlclByb2ZpbGVJbmZvID0gY3JlYXRlRWxlbWVudChcImlucHV0XCIsIFtcIm1haW4tcHJvZmlsZXNfX25hbWVcIl0sIHtcclxuXHRcdHR5cGU6IFwidGV4dFwiLFxyXG5cdFx0cmVhZG9ubHk6IHRydWUsXHJcblx0XHR2YWx1ZTpcclxuXHRcdFx0ZXhpc3RpbmdQcm9maWxlc1tgdXNlci1wcm9maWxlLSR7cHJvZmlsZXNDb3VudH1gXSB8fFxyXG5cdFx0XHRgSGFuZHNvbWUgVXNlciAke3Byb2ZpbGVzQ291bnR9YCxcclxuXHR9KTtcclxuXHRjb25zdCBlZGl0VXNlckluZm9CdG4gPSBjcmVhdGVFbGVtZW50KFxyXG5cdFx0XCJidXR0b25cIixcclxuXHRcdFtcIm1haW4tcHJvZmlsZXNfX2VkaXQtbmFtZVwiXSxcclxuXHRcdHsgXCJhcmlhLWxhYmVsXCI6IHVzZXJCdG5JbmZvIH1cclxuXHQpO1xyXG5cdGNvbnN0IGVkaXRVc2VySW5mb0ljb24gPSBjcmVhdGVFbGVtZW50KFwiaW1nXCIsIFtcIm1haW4tcHJvZmlsZXNfX2VkaXQtaWNvblwiXSwge1xyXG5cdFx0d2lkdGg6IFwiMjRcIixcclxuXHRcdGhlaWdodDogXCIyNFwiLFxyXG5cdFx0bG9hZGluZzogXCJsYXp5XCIsXHJcblx0XHRhbHQ6IFwiXCIsXHJcblx0XHRzcmM6IFwiLi9zcmMvaWNvbnMvZWRpdC5zdmdcIixcclxuXHR9KTtcclxuXHJcblx0dXNlclByb2ZpbGVCdG4uaW5uZXJIVE1MID0gYDxzdmcgY2xhc3M9XCJtYWluLXByb2ZpbGVzX19pbWdcIiB3aWR0aD1cIjE1MFwiIGhlaWdodD1cIjE1MFwiIHZpZXdCb3g9XCIwIDAgMjAwIDIwMFwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cclxuXHQ8Y2lyY2xlIGN4PVwiNzBcIiBjeT1cIjcwXCIgcj1cIjhcIiBmaWxsPVwid2hpdGVcIiAvPlxyXG5cdDxjaXJjbGUgY3g9XCIxMzBcIiBjeT1cIjcwXCIgcj1cIjhcIiBmaWxsPVwid2hpdGVcIiAvPlxyXG5cdDxwYXRoIGQ9XCJNNjAgMTEwIFExMDAgMTUwIDE0MCAxMTBcIiBzdHJva2U9XCJ3aGl0ZVwiIHN0cm9rZS13aWR0aD1cIjZcIlxyXG5cdGZpbGw9XCJ0cmFuc3BhcmVudFwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiAvPlxyXG5cdDwvc3ZnPmA7XHJcblx0dXNlclByb2ZpbGVCdG4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XHJcblxyXG5cdHVzZXJBdmF0YXJCb3guYXBwZW5kKHVzZXJQcm9maWxlQnRuKTtcclxuXHRlZGl0VXNlckluZm9CdG4uYXBwZW5kKGVkaXRVc2VySW5mb0ljb24pO1xyXG5cdHVzZXJQcm9maWxlSW5mb0JveC5hcHBlbmQodXNlclByb2ZpbGVJbmZvLCBlZGl0VXNlckluZm9CdG4pO1xyXG5cdHVzZXJQcm9maWxlLmFwcGVuZCh1c2VyQXZhdGFyQm94LCB1c2VyUHJvZmlsZUluZm9Cb3gpO1xyXG5cclxuXHQvLyBzZXRVc2VyUHJlZmVyZW5jZShcInByb2ZpbGVzQ291bnRcIiwgcHJvZmlsZXNDb3VudCwgdXNlckRhdGEpXHJcblxyXG5cdGlmICghZXhpc3RpbmdQcm9maWxlc1tgdXNlci1wcm9maWxlLSR7cHJvZmlsZXNDb3VudH1gXSkge1xyXG5cdFx0Y29uc3QgdXBkYXRlZFByb2ZpbGVzID0ge1xyXG5cdFx0XHQuLi5leGlzdGluZ1Byb2ZpbGVzLFxyXG5cdFx0XHRbYHVzZXItcHJvZmlsZS0ke3Byb2ZpbGVzQ291bnR9YF06IGBIYW5kc29tZSBVc2VyICR7cHJvZmlsZXNDb3VudH1gLFxyXG5cdFx0fTtcclxuXHRcdHNldFVzZXJQcmVmZXJlbmNlKFwidXNlclByb2ZpbGVzXCIsIHVwZGF0ZWRQcm9maWxlcywgdXNlckRhdGEpO1xyXG5cdH1cclxuXHJcblx0ZWRpdFVzZXJJbmZvQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0ZWRpdFVzZXJuYW1lKGUsIHVzZXJQcm9maWxlSW5mb0JveCwgc2F2ZUJ0bkFyaWEpO1xyXG5cdH0pO1xyXG5cdHVzZXJQcm9maWxlSW5mby5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG5cdFx0aWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcclxuXHRcdFx0c2F2ZVVzZXJuYW1lKGUpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4gdXNlclByb2ZpbGU7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVQcm9maWxlQWRkQnRuID0gKFxyXG5cdGFyaWFJbmZvLFxyXG5cdGluZm8sXHJcblx0dXNlckJ0bkFyaWEsXHJcblx0cHJvZmlsZXNCb3gsXHJcblx0dXNlckJ0bkluZm8sXHJcblx0c2F2ZUJ0bkFyaWFcclxuKSA9PiB7XHJcblx0Y29uc3QgYWRkUHJvZmlsZUJveCA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibWFpbi1wcm9maWxlc19fYWRkLXByb2ZpbGVcIl0pO1xyXG5cdGNvbnN0IGFkZFByb2ZpbGVBdmF0YXIgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcIm1haW4tcHJvZmlsZXNfX2F2YXRhclwiXSk7XHJcblx0Y29uc3QgYWRkUHJvZmlsZUJ0biA9IGNyZWF0ZUVsZW1lbnQoXHJcblx0XHRcImJ1dHRvblwiLFxyXG5cdFx0W1wibWFpbi1wcm9maWxlc19fYnRuXCIsIFwibWFpbi1wcm9maWxlc19fYnRuLS1hZGQtcHJvZmlsZVwiXSxcclxuXHRcdHsgXCJhcmlhLWxhYmVsXCI6IGFyaWFJbmZvIH1cclxuXHQpO1xyXG5cdGNvbnN0IGFkZFByb2ZpbGVQbHVzSWNvbiA9IGNyZWF0ZUVsZW1lbnQoXCJpbWdcIiwgW1wibWFpbi1wcm9maWxlc19fYWRkLWltZ1wiXSwge1xyXG5cdFx0c3JjOiBcIi4vc3JjL2ljb25zL2FkZC1wcm9maWxlLnN2Z1wiLFxyXG5cdFx0bG9hZGluZzogXCJsYXp5XCIsXHJcblx0XHRhbHQ6IFwiXCIsXHJcblx0fSk7XHJcblx0Y29uc3QgYWRkUHJvZmlsZUluZm8gPSBjcmVhdGVFbGVtZW50KFwic3BhblwiLCBbXCJtYWluLXByb2ZpbGVzX19uYW1lXCJdKTtcclxuXHJcblx0YWRkUHJvZmlsZUluZm8udGV4dENvbnRlbnQgPSBpbmZvO1xyXG5cclxuXHRhZGRQcm9maWxlQnRuLmFwcGVuZChhZGRQcm9maWxlUGx1c0ljb24pO1xyXG5cdGFkZFByb2ZpbGVBdmF0YXIuYXBwZW5kKGFkZFByb2ZpbGVCdG4pO1xyXG5cdGFkZFByb2ZpbGVCb3guYXBwZW5kKGFkZFByb2ZpbGVBdmF0YXIsIGFkZFByb2ZpbGVJbmZvKTtcclxuXHJcblx0YWRkUHJvZmlsZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG5cdFx0Y29uc3QgcHJvZmlsZSA9IGNyZWF0ZVByb2ZpbGUodXNlckJ0bkFyaWEsIHVzZXJCdG5JbmZvLCBzYXZlQnRuQXJpYSk7XHJcblxyXG5cdFx0aWYgKHByb2ZpbGUpIHtcclxuXHRcdFx0cHJvZmlsZXNCb3guYXBwZW5kKHByb2ZpbGUpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0c2hvd0Vycm9yUG9wdXAoXCJPc2nEhWduacSZdG8gbWFrc3ltYWxuxIUgaWxvxZvEhyBwcm9maWzDs3chXCIsIFwiI2RjNGEzNFwiKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIGFkZFByb2ZpbGVCb3g7XHJcbn07XHJcblxyXG5jb25zdCBlZGl0VXNlcm5hbWUgPSAoZSwgcGFyZW50LCBzYXZlQnRuQXJpYSkgPT4ge1xyXG5cdHJlc2V0U3RhdGVPZkVkaXRpbmcoZSk7XHJcblxyXG5cdGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldDtcclxuXHRjb25zdCBuYW1lVG9FZGl0ID0gZWRpdEJ0bi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG5cdGNvbnN0IHNhdmVCdG4gPSBjcmVhdGVTYXZlQnRuKHNhdmVCdG5BcmlhKTtcclxuXHJcblx0ZWRpdEJ0bi5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG5cdHNhdmVCdG4uY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcclxuXHJcblx0cGFyZW50LmFwcGVuZChzYXZlQnRuKTtcclxuXHJcblx0bmFtZVRvRWRpdC5mb2N1cygpO1xyXG5cdG5hbWVUb0VkaXQuc2VsZWN0KCk7XHJcblx0bmFtZVRvRWRpdC5yZW1vdmVBdHRyaWJ1dGUoXCJyZWFkb25seVwiKTtcclxuXHRuYW1lVG9FZGl0LmNsYXNzTGlzdC5hZGQoXCJmb2N1c2VkXCIpO1xyXG5cclxuXHRzYXZlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0c2F2ZVVzZXJuYW1lKGUpO1xyXG5cdH0pO1xyXG59O1xyXG5cclxuY29uc3Qgc2F2ZVVzZXJuYW1lID0gKGUpID0+IHtcclxuXHRjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2U/Lihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuXHRjb25zdCBleGlzdGluZ1Byb2ZpbGVzID0gdXNlckRhdGE/LnVzZXJQcm9maWxlcyB8fCBbXTtcclxuXHJcblx0Y29uc3Qgc2F2ZUJ0biA9IGUudGFyZ2V0O1xyXG5cdGNvbnN0IGNsb3Nlc3RQcm9maWxlID0gc2F2ZUJ0bi5jbG9zZXN0KFwiLm1haW4tcHJvZmlsZXNfX3Byb2ZpbGVcIik7XHJcblx0Y29uc3QgY2xvc2VzdFByb2ZpbGVJZCA9IGNsb3Nlc3RQcm9maWxlLnF1ZXJ5U2VsZWN0b3IoXCIubWFpbi1wcm9maWxlc19fYnRuXCIpXHJcblx0XHQuZGF0YXNldC5pZDtcclxuXHRjb25zdCBjbG9zZXN0UHJvZmlsZU5hbWUgPSBjbG9zZXN0UHJvZmlsZS5xdWVyeVNlbGVjdG9yKFxyXG5cdFx0XCIubWFpbi1wcm9maWxlc19fbmFtZVwiXHJcblx0KTtcclxuXHJcblx0aWYgKGNsb3Nlc3RQcm9maWxlTmFtZS52YWx1ZS50cmltKCkgPT09IFwiXCIpXHJcblx0XHRyZXR1cm4gc2hvd0Vycm9yUG9wdXAoJ1BvbGUgbmllIG1vxbxlIGJ5xIcgcHVzdGUnLCAnI0ZBQzA0NCcpXHJcblxyXG5cdGNvbnN0IHVwZGF0ZWRQcm9maWxlcyA9IHtcclxuXHRcdC4uLmV4aXN0aW5nUHJvZmlsZXMsXHJcblx0XHRbY2xvc2VzdFByb2ZpbGVJZF06IGNsb3Nlc3RQcm9maWxlTmFtZS52YWx1ZSxcclxuXHR9O1xyXG5cdHNldFVzZXJQcmVmZXJlbmNlKFwidXNlclByb2ZpbGVzXCIsIHVwZGF0ZWRQcm9maWxlcywgdXNlckRhdGEpO1xyXG5cclxuXHRyZXNldFN0YXRlT2ZFZGl0aW5nKGUpO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlU2F2ZUJ0biA9IChzYXZlQnRuQXJpYSkgPT4ge1xyXG5cdGNvbnN0IHNhdmVVc2VySW5mb0J0biA9IGNyZWF0ZUVsZW1lbnQoXHJcblx0XHRcImJ1dHRvblwiLFxyXG5cdFx0W1wibWFpbi1wcm9maWxlc19fc2F2ZS1uYW1lXCIsIFwiaGlkZGVuXCJdLFxyXG5cdFx0eyBcImFyaWEtbGFiZWxcIjogc2F2ZUJ0bkFyaWEgfVxyXG5cdCk7XHJcblx0Y29uc3Qgc2F2ZVVzZXJJbmZvSWNvbiA9IGNyZWF0ZUVsZW1lbnQoXCJpbWdcIiwgW1wibWFpbi1wcm9maWxlc19fc2F2ZS1pY29uXCJdLCB7XHJcblx0XHR3aWR0aDogXCIyNFwiLFxyXG5cdFx0aGVpZ2h0OiBcIjI0XCIsXHJcblx0XHRsb2FkaW5nOiBcImxhenlcIixcclxuXHRcdGFsdDogXCJcIixcclxuXHRcdHNyYzogXCIuL3NyYy9pY29ucy9zYXZlLnN2Z1wiLFxyXG5cdH0pO1xyXG5cclxuXHRzYXZlVXNlckluZm9CdG4uYXBwZW5kKHNhdmVVc2VySW5mb0ljb24pO1xyXG5cclxuXHRyZXR1cm4gc2F2ZVVzZXJJbmZvQnRuO1xyXG59O1xyXG5cclxuY29uc3QgcmVzZXRTdGF0ZU9mRWRpdGluZyA9IChlKSA9PiB7XHJcblx0Y29uc3QgZm9jdXNlZE5hbWVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb2N1c2VkXCIpO1xyXG5cdGNvbnN0IGFsbFNhdmVCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tYWluLXByb2ZpbGVzX19zYXZlLW5hbWVcIik7XHJcblx0Y29uc3QgYWxsRWRpdEJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1haW4tcHJvZmlsZXNfX2VkaXQtbmFtZVwiKTtcclxuXHJcblx0Zm9jdXNlZE5hbWVzLmZvckVhY2goKGVsKSA9PiB7XHJcblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJyZWFkb25seVwiLCB0cnVlKTtcclxuXHRcdGVsLmNsYXNzTGlzdC5yZW1vdmUoXCJmb2N1c2VkXCIpO1xyXG5cdFx0ZWwuYmx1cigpO1xyXG5cdH0pO1xyXG5cdGFsbFNhdmVCdG5zLmZvckVhY2goKGJ0bikgPT4gYnRuLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIikpO1xyXG5cdGFsbEVkaXRCdG5zLmZvckVhY2goKGJ0bikgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIikpO1xyXG59O1xyXG5cclxubGV0IHBvcHVwVmlzaWJsZSA9IGZhbHNlO1xyXG5jb25zdCBzaG93RXJyb3JQb3B1cCA9ICh0ZXh0LCBjb2xvcikgPT4ge1xyXG5cdGlmIChwb3B1cFZpc2libGUpIHJldHVybjtcclxuXHRwb3B1cFZpc2libGUgPSB0cnVlO1xyXG5cclxuXHRjb25zdCByb290ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xyXG5cdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyXCIpO1xyXG5cclxuXHRjb25zdCBwb3B1cCA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wiZXJyb3ItcG9wdXBcIl0pO1xyXG5cdGNvbnN0IHBvcHVwRXJyb3IgPSBjcmVhdGVFbGVtZW50KFwicFwiLCBbXCJlcnJvci1wb3B1cF9fdGV4dFwiXSk7XHJcblxyXG5cdHBvcHVwRXJyb3IudGV4dENvbnRlbnQgPSB0ZXh0O1xyXG5cdHJvb3Quc3R5bGUuc2V0UHJvcGVydHkoXCItLWVycm9yVHh0Q29sb3JcIiwgY29sb3IpO1xyXG5cclxuXHRwb3B1cC5hcHBlbmQocG9wdXBFcnJvcik7XHJcblx0Y29udGFpbmVyLmFwcGVuZChwb3B1cCk7XHJcblxyXG5cdHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0cG9wdXAuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcclxuXHR9LCAyMDAwKTtcclxuXHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdHBvcHVwLnJlbW92ZSgpO1xyXG5cdFx0cG9wdXBWaXNpYmxlID0gZmFsc2U7XHJcblx0fSwgMjUwMCk7XHJcbn07XHJcbiJdfQ==
