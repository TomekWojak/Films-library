import{createElement}from"./helpers.min.js";import{setUserPreference}from"./updateStateFunctions.min.js";const userData=JSON.parse?.(localStorage.getItem("userData"));let profilesCount=userData?.profilesCount||0;const USERNAME="handsomeUser404",PASSWORD="5jksH9d.";export const createLoginHeader=({header:{alt:{logo:e},aria:{logoLink:t,changeLanguageButton:a}}},n,r,o,i)=>{const l=createElement("header",["header"]),s=createElement("a",["header__logo","login-header__logo"],{href:"/","aria-label":`${t}`}),c=createElement("img",["header__logo-img","login-header__logo-img"],{src:"./src/icons/logo.svg",alt:`${e}`,width:"24",height:"24"}),d=createElement("span",["header__logo-text","login-header__logo-text"]);d.textContent="Stream",s.append(c,d),l.append(s);const p=createElement("button",["login-header__lang-select"],{"aria-label":`${a}`}),m=createElement("span",["login-header__lang-platform-lang"]),f=createElement("img",["login-header__lang-arrow"],{src:"./src/icons/chevron-down.svg",alt:"",width:"24",height:"24"}),g=createElement("ul",["login-header__lang-list"]);for(let e=0;e<n;e++){const t=createElement("li",["login-header__lang-choice"],{tabindex:0}),a=Object.keys(r)[e],n=Object.values(r)[e];t.dataset.lang=a,t.textContent=n,t.style.animationDelay=100*e+"ms",g.append(t)}return m.textContent=r[o],p.addEventListener("click",e=>{i.call(p,e,m)}),p.append(m,f,g),l.append(p),l};export const createLoginPage=({main:{text:{title:e,subtitle:t,description:a,button:n},placeholder:{username:r,password:o}}})=>{const i=createElement("main",["main"]),l=createElement("div",["wrapper"]),s=createElement("h1"),c=createElement("span",["main__title"]),d=createElement("span",["main__subtitle"]),p=createElement("p",["main__text"]),m=createElement("form",["main__form"]),f=createElement("input",["main__form-input","main__form-input--username"],{type:"text",placeholder:r}),g=createElement("input",["main__form-input","main__form-input--password"],{type:"password",placeholder:o}),u=createElement("button",["main__form-button"],{type:"submit"}),_=createElement("span",["main__form-button-text"]),h=createElement("p",["main__form-error-txt"]);return c.textContent=e,d.textContent=t,p.textContent=a,_.textContent=n,s.append(c,d),u.append(_),m.append(f,g,u,h),l.append(s,p,m),i.append(l),u.addEventListener("click",e=>{const t=JSON.parse?.(localStorage.getItem("userData"));handleLoginValidation(e,f,g,translations.main.text.errorRequired,translations.main.text.errorInvalid,USERNAME,PASSWORD,h)||(h.classList.remove("visible"),e.target.append(showSmallLoader()),e.target.disabled=!0,setTimeout(()=>{e.target.disabled=!1,hideSmallLoader(),setUserPreference("translations",translations,t),setUserPreference("loggedIn",!0,t),window.location.href="profiles.html"},3e3))}),i};const handleLoginValidation=(e,t,a,n,r,o,i,l)=>(e.preventDefault(),""===t.value.trim()||""===a.value.trim()?(l.classList.add("visible"),l.textContent=n,n):t.value.trim()!==o||a.value.trim()!==i?(e.target.disabled=!0,e.target.append(showSmallLoader()),l.classList.remove("visible"),setTimeout(()=>{l.classList.add("visible"),l.textContent=r,e.target.disabled=!1,hideSmallLoader()},3e3),r):null);export const showBigLoader=()=>{const e=createElement("div",["loading-area"]);return e.innerHTML='            <svg class="loader-big" viewBox="0 0 120 120" width="120" height="120">\n                <defs>\n                    <linearGradient id="loader-accent" x1="0%" y1="0%" x2="100%" y2="0%">\n                        <stop offset="0%" stop-color="#4da8da" stop-opacity="0.8" />\n                        <stop offset="70%" stop-color="#4da8da" stop-opacity="0.4" />\n                        <stop offset="100%" stop-color="#4da8da" stop-opacity="0" />\n                    </linearGradient>\n                </defs>\n                <circle class="loading-circle-big" r="35" cx="60" cy="60"></circle>\n            </svg>',e};export const hideBigLoader=()=>{const e=document.querySelector(".loading-area");e?.remove()};export const showSmallLoader=()=>{const e=createElement("div",["loading-area-small"]);return e.innerHTML='<svg class="loader-small" viewBox="0 0 120 120" width="120" height="120">\n                <defs>\n                    <linearGradient id="loader-accent-small" x1="0%" y1="0%" x2="100%" y2="0%">\n                        <stop offset="0%" stop-color="white" stop-opacity="0.8" />\n                        <stop offset="70%" stop-color="white" stop-opacity="0.3" />\n                        <stop offset="100%" stop-color="white" stop-opacity="0" />\n                    </linearGradient>\n                </defs>\n                <circle class="loading-circle-small" r="12" cx="60" cy="60"></circle>\n            </svg>',e};export const hideSmallLoader=()=>{document.querySelector(".loading-area-small").remove()};export const createProfilesPage=({profiles:{text:{title:e,addProfileInfo:t},aria:{addProfileBtn:a,userProfileBtn:n,userBtnCustomize:r}}})=>{const o=JSON.parse?.(localStorage.getItem("userData")),i=o?.userProfiles,l=document.querySelector(".container"),s=createElement("main",["main-profiles"]),c=createElement("div",["wrapper"]),d=createElement("h1",["main__title","main-profiles__title"]),p=createElement("div",["main-profiles__box"]);if(d.textContent=e,i&&0!==Object.keys(i).length)for(const e in i)p.append(createProfile(n,r,r));p.append(createProfileAddBtn(a,t,n,p,r,r)),c.append(d,p),s.append(c),l.append(s)};const createProfile=(e,t,a)=>{const n=JSON.parse?.(localStorage.getItem("userData")),r=n?.userProfiles||[];let o;if(3==profilesCount||3===r.length)return;profilesCount++,o=["#dc4a34","#062E63","#FAC044"][profilesCount];const i=createElement("div",["main-profiles__profile"]),l=createElement("div",["main-profiles__avatar"]),s=createElement("button",["main-profiles__btn"],{"aria-label":e,"data-id":`user-profile-${profilesCount}`}),c=createElement("div",["main-profiles__user-info"]),d=createElement("input",["main-profiles__name"],{type:"text",readonly:!0,value:r[`user-profile-${profilesCount}`]||`Handsome User ${profilesCount}`}),p=createElement("button",["main-profiles__edit-name"],{"aria-label":t}),m=createElement("img",["main-profiles__edit-icon"],{width:"24",height:"24",loading:"lazy",alt:"",src:"./src/icons/edit.svg"});if(s.innerHTML='<svg class="main-profiles__img" width="150" height="150" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">\n\t<circle cx="70" cy="70" r="8" fill="white" />\n\t<circle cx="130" cy="70" r="8" fill="white" />\n\t<path d="M60 110 Q100 150 140 110" stroke="white" stroke-width="6"\n\tfill="transparent" stroke-linecap="round" />\n\t</svg>',s.style.backgroundColor=o,l.append(s),p.append(m),c.append(d,p),i.append(l,c),!r[`user-profile-${profilesCount}`]){const e={...r,[`user-profile-${profilesCount}`]:`Handsome User ${profilesCount}`};setUserPreference("userProfiles",e,n)}return p.addEventListener("click",e=>{editUsername(e,c,a)}),d.addEventListener("keydown",e=>{"Enter"===e.key&&saveUsername(e)}),i},createProfileAddBtn=(e,t,a,n,r,o)=>{const i=createElement("div",["main-profiles__add-profile"]),l=createElement("div",["main-profiles__avatar"]),s=createElement("button",["main-profiles__btn","main-profiles__btn--add-profile"],{"aria-label":e}),c=createElement("img",["main-profiles__add-img"],{src:"./src/icons/add-profile.svg",loading:"lazy",alt:""}),d=createElement("span",["main-profiles__name"]);return d.textContent=t,s.append(c),l.append(s),i.append(l,d),s.addEventListener("click",()=>{const e=createProfile(a,r,o);e?n.append(e):alert("Osiągnięto maksymalną liczbę profilów!")}),i},editUsername=(e,t,a)=>{resetStateOfEditing(e);const n=e.target,r=n.previousElementSibling,o=createSaveBtn(a);n.classList.add("hidden"),o.classList.remove("hidden"),t.append(o),r.focus(),r.select(),r.removeAttribute("readonly"),r.classList.add("focused"),o.addEventListener("click",e=>{saveUsername(e)})},saveUsername=e=>{const t=JSON.parse?.(localStorage.getItem("userData")),a=t?.userProfiles||[],n=e.target.closest(".main-profiles__profile"),r=n.querySelector(".main-profiles__btn").dataset.id,o=n.querySelector(".main-profiles__name");if(""===o.value.trim())return alert("Nie moze być puste!");const i={...a,[r]:o.value};setUserPreference("userProfiles",i,t),resetStateOfEditing(e)},createSaveBtn=e=>{const t=createElement("button",["main-profiles__save-name","hidden"],{"aria-label":e}),a=createElement("img",["main-profiles__save-icon"],{width:"24",height:"24",loading:"lazy",alt:"",src:"./src/icons/save.svg"});return t.append(a),t},resetStateOfEditing=e=>{const t=e.target,a=document.querySelectorAll(".focused"),n=document.querySelectorAll(".main-profiles__save-name"),r=document.querySelectorAll(".main-profiles__edit-name");a.forEach(e=>{e.setAttribute("readonly",!0),e.classList.remove("focused"),e.blur()}),n.forEach(e=>e.classList.add("hidden")),r.forEach(e=>e.classList.remove("hidden")),t.classList.add("hidden")};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50cy5taW4uanMiLCJuYW1lcyI6WyJjcmVhdGVFbGVtZW50Iiwic2V0VXNlclByZWZlcmVuY2UiLCJ1c2VyRGF0YSIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJwcm9maWxlc0NvdW50IiwiVVNFUk5BTUUiLCJQQVNTV09SRCIsImNyZWF0ZUxvZ2luSGVhZGVyIiwiaGVhZGVyIiwiYWx0IiwibG9nbyIsImFyaWEiLCJsb2dvTGluayIsImNoYW5nZUxhbmd1YWdlQnV0dG9uIiwibGFuZ0Ftb3VudCIsImxhbmdOYW1lcyIsImxhbmd1YWdlIiwiaGFuZGxlTGFuZ1NlbGVjdCIsInBhZ2VMb2dvIiwiaHJlZiIsImxvZ29JbWciLCJzcmMiLCJ3aWR0aCIsImhlaWdodCIsImxvZ29UZXh0IiwidGV4dENvbnRlbnQiLCJhcHBlbmQiLCJsYW5nU2VsZWN0IiwibGFuZ1BsYXRmb3JtTGFuZyIsImxhbmdBcnJvdyIsImxhbmdMaXN0IiwiaSIsImxhbmdDaG9pY2UiLCJ0YWJpbmRleCIsImRhdGEiLCJPYmplY3QiLCJrZXlzIiwidGV4dCIsInZhbHVlcyIsImRhdGFzZXQiLCJsYW5nIiwic3R5bGUiLCJhbmltYXRpb25EZWxheSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY2FsbCIsImNyZWF0ZUxvZ2luUGFnZSIsIm1haW4iLCJ0aXRsZSIsInN1YnRpdGxlIiwiZGVzY3JpcHRpb24iLCJidXR0b24iLCJwbGFjZWhvbGRlciIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJtYWluQ29udGVudCIsIndyYXBwZXIiLCJsb2dpblRpdGxlIiwibG9naW5UaXRsZVRvcCIsImxvZ2luVGl0bGVCb3R0b20iLCJsb2dpblRleHQiLCJmb3JtIiwidXNlcm5hbWVJbnB1dCIsInR5cGUiLCJwYXNzd29yZElucHV0Iiwic3VibWl0QnRuIiwiYnV0dG9uVGV4dCIsImVycm9yVHh0IiwiaGFuZGxlTG9naW5WYWxpZGF0aW9uIiwidHJhbnNsYXRpb25zIiwiZXJyb3JSZXF1aXJlZCIsImVycm9ySW52YWxpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRhcmdldCIsInNob3dTbWFsbExvYWRlciIsImRpc2FibGVkIiwic2V0VGltZW91dCIsImhpZGVTbWFsbExvYWRlciIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVxdWlyZUVycm9yIiwiaW52YWxpZEVycm9yIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInRyaW0iLCJhZGQiLCJzaG93QmlnTG9hZGVyIiwibG9hZGluZ0FyZWEiLCJpbm5lckhUTUwiLCJoaWRlQmlnTG9hZGVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlUHJvZmlsZXNQYWdlIiwicHJvZmlsZXMiLCJhZGRQcm9maWxlSW5mbyIsImFkZFByb2ZpbGVCdG4iLCJ1c2VyUHJvZmlsZUJ0biIsInVzZXJCdG5DdXN0b21pemUiLCJ1c2VyUHJvZmlsZXNMaXN0IiwidXNlclByb2ZpbGVzIiwiY29udGFpbmVyIiwicHJvZmlsZXNQYWdlTWFpbiIsInByb2ZpbGVzVGl0bGUiLCJwcm9maWxlc0JveCIsImxlbmd0aCIsImtleSIsImNyZWF0ZVByb2ZpbGUiLCJjcmVhdGVQcm9maWxlQWRkQnRuIiwiYXJpYUluZm8iLCJ1c2VyQnRuSW5mbyIsInNhdmVCdG5BcmlhIiwiZXhpc3RpbmdQcm9maWxlcyIsImNvbG9yIiwidXNlclByb2ZpbGUiLCJ1c2VyQXZhdGFyQm94IiwidXNlclByb2ZpbGVJbmZvQm94IiwidXNlclByb2ZpbGVJbmZvIiwicmVhZG9ubHkiLCJlZGl0VXNlckluZm9CdG4iLCJlZGl0VXNlckluZm9JY29uIiwibG9hZGluZyIsImJhY2tncm91bmRDb2xvciIsInVwZGF0ZWRQcm9maWxlcyIsImVkaXRVc2VybmFtZSIsInNhdmVVc2VybmFtZSIsImluZm8iLCJ1c2VyQnRuQXJpYSIsImFkZFByb2ZpbGVCb3giLCJhZGRQcm9maWxlQXZhdGFyIiwiYWRkUHJvZmlsZVBsdXNJY29uIiwicHJvZmlsZSIsImFsZXJ0IiwicGFyZW50IiwicmVzZXRTdGF0ZU9mRWRpdGluZyIsImVkaXRCdG4iLCJuYW1lVG9FZGl0IiwicHJldmlvdXNFbGVtZW50U2libGluZyIsInNhdmVCdG4iLCJjcmVhdGVTYXZlQnRuIiwiZm9jdXMiLCJzZWxlY3QiLCJyZW1vdmVBdHRyaWJ1dGUiLCJjbG9zZXN0UHJvZmlsZSIsImNsb3Nlc3QiLCJjbG9zZXN0UHJvZmlsZUlkIiwiaWQiLCJjbG9zZXN0UHJvZmlsZU5hbWUiLCJzYXZlVXNlckluZm9CdG4iLCJzYXZlVXNlckluZm9JY29uIiwiZm9jdXNlZE5hbWVzIiwicXVlcnlTZWxlY3RvckFsbCIsImFsbFNhdmVCdG5zIiwiYWxsRWRpdEJ0bnMiLCJmb3JFYWNoIiwiZWwiLCJzZXRBdHRyaWJ1dGUiLCJibHVyIiwiYnRuIl0sInNvdXJjZXMiOlsiY29tcG9uZW50cy5qcyJdLCJtYXBwaW5ncyI6Ik9BQVNBLGtCQUFxQiwwQkFDckJDLHNCQUF5QixnQ0FDbEMsTUFBTUMsU0FBV0MsS0FBS0MsUUFBUUMsYUFBYUMsUUFBUSxhQUVuRCxJQUFJQyxjQUFnQkwsVUFBVUssZUFBaUIsRUFDL0MsTUFBTUMsU0FBVyxrQkFDWEMsU0FBVyxrQkFFVixNQUFNQyxrQkFBb0IsRUFFL0JDLFFBQ0NDLEtBQU9DLFFBQ1BDLE1BQVFDLFdBQVVDLDBCQUdwQkMsRUFDQUMsRUFDQUMsRUFDQUMsS0FHQSxNQUFNVCxFQUFTWCxjQUFjLFNBQVUsQ0FBQyxXQUNsQ3FCLEVBQVdyQixjQUFjLElBQUssQ0FBQyxlQUFnQixzQkFBdUIsQ0FDM0VzQixLQUFNLElBQ04sYUFBYyxHQUFHUCxNQUVaUSxFQUFVdkIsY0FDZixNQUNBLENBQUMsbUJBQW9CLDBCQUNyQixDQUNDd0IsSUFBSyx1QkFDTFosSUFBSyxHQUFHQyxJQUNSWSxNQUFPLEtBQ1BDLE9BQVEsT0FHSkMsRUFBVzNCLGNBQWMsT0FBUSxDQUN0QyxvQkFDQSw0QkFFRDJCLEVBQVNDLFlBQWMsU0FDdkJQLEVBQVNRLE9BQU9OLEVBQVNJLEdBQ3pCaEIsRUFBT2tCLE9BQU9SLEdBSWQsTUFBTVMsRUFBYTlCLGNBQWMsU0FBVSxDQUFDLDZCQUE4QixDQUN6RSxhQUFjLEdBQUdnQixNQUVaZSxFQUFtQi9CLGNBQWMsT0FBUSxDQUM5QyxxQ0FFS2dDLEVBQVloQyxjQUFjLE1BQU8sQ0FBQyw0QkFBNkIsQ0FDcEV3QixJQUFLLCtCQUNMWixJQUFLLEdBQ0xhLE1BQU8sS0FDUEMsT0FBUSxPQUVITyxFQUFXakMsY0FBYyxLQUFNLENBQUMsNEJBRXRDLElBQUssSUFBSWtDLEVBQUksRUFBR0EsRUFBSWpCLEVBQVlpQixJQUFLLENBQ3BDLE1BQU1DLEVBQWFuQyxjQUFjLEtBQU0sQ0FBQyw2QkFBOEIsQ0FDckVvQyxTQUFVLElBRUxDLEVBQU9DLE9BQU9DLEtBQUtyQixHQUFXZ0IsR0FDOUJNLEVBQU9GLE9BQU9HLE9BQU92QixHQUFXZ0IsR0FFdENDLEVBQVdPLFFBQVFDLEtBQU9OLEVBQzFCRixFQUFXUCxZQUFjWSxFQUN6QkwsRUFBV1MsTUFBTUMsZUFBcUIsSUFBSlgsRUFBVSxLQUM1Q0QsRUFBU0osT0FBT00sRUFDakIsQ0FXQSxPQVRBSixFQUFpQkgsWUFBY1YsRUFBVUMsR0FFekNXLEVBQVdnQixpQkFBaUIsUUFBVUMsSUFDckMzQixFQUFpQjRCLEtBQUtsQixFQUFZaUIsRUFBR2hCLEtBR3RDRCxFQUFXRCxPQUFPRSxFQUFrQkMsRUFBV0MsR0FDL0N0QixFQUFPa0IsT0FBT0MsR0FFUG5CLFVBSUQsTUFBTXNDLGdCQUFrQixFQUM5QkMsTUFDQ1YsTUFBUVcsUUFBT0MsV0FBVUMsY0FBYUMsVUFDdENDLGFBQWVDLFdBQVVDLGlCQUcxQixNQUFNQyxFQUFjMUQsY0FBYyxPQUFRLENBQUMsU0FDckMyRCxFQUFVM0QsY0FBYyxNQUFPLENBQUMsWUFDaEM0RCxFQUFhNUQsY0FBYyxNQUMzQjZELEVBQWdCN0QsY0FBYyxPQUFRLENBQUMsZ0JBQ3ZDOEQsRUFBbUI5RCxjQUFjLE9BQVEsQ0FBQyxtQkFDMUMrRCxFQUFZL0QsY0FBYyxJQUFLLENBQUMsZUFDaENnRSxFQUFPaEUsY0FBYyxPQUFRLENBQUMsZUFDOUJpRSxFQUFnQmpFLGNBQ3JCLFFBQ0EsQ0FBQyxtQkFBb0IsOEJBQ3JCLENBQUVrRSxLQUFNLE9BQVFYLFlBQWFDLElBRXhCVyxFQUFnQm5FLGNBQ3JCLFFBQ0EsQ0FBQyxtQkFBb0IsOEJBQ3JCLENBQUVrRSxLQUFNLFdBQVlYLFlBQWFFLElBRTVCVyxFQUFZcEUsY0FBYyxTQUFVLENBQUMscUJBQXNCLENBQ2hFa0UsS0FBTSxXQUVERyxFQUFhckUsY0FBYyxPQUFRLENBQUMsMkJBRXBDc0UsRUFBV3RFLGNBQWMsSUFBSyxDQUFDLHlCQTJDckMsT0ExQ0E2RCxFQUFjakMsWUFBY3VCLEVBQzVCVyxFQUFpQmxDLFlBQWN3QixFQUMvQlcsRUFBVW5DLFlBQWN5QixFQUN4QmdCLEVBQVd6QyxZQUFjMEIsRUFFekJNLEVBQVcvQixPQUFPZ0MsRUFBZUMsR0FDakNNLEVBQVV2QyxPQUFPd0MsR0FDakJMLEVBQUtuQyxPQUFPb0MsRUFBZUUsRUFBZUMsRUFBV0UsR0FFckRYLEVBQVE5QixPQUFPK0IsRUFBWUcsRUFBV0MsR0FDdENOLEVBQVk3QixPQUFPOEIsR0FFbkJTLEVBQVV0QixpQkFBaUIsUUFBVUMsSUFDcEMsTUFBTTdDLEVBQVdDLEtBQUtDLFFBQVFDLGFBQWFDLFFBQVEsYUFFbkNpRSxzQkFDZnhCLEVBQ0FrQixFQUNBRSxFQUNBSyxhQUFhdEIsS0FBS1YsS0FBS2lDLGNBQ3ZCRCxhQUFhdEIsS0FBS1YsS0FBS2tDLGFBQ3ZCbEUsU0FDQUMsU0FDQTZELEtBSUFBLEVBQVNLLFVBQVVDLE9BQU8sV0FDMUI3QixFQUFFOEIsT0FBT2hELE9BQU9pRCxtQkFDaEIvQixFQUFFOEIsT0FBT0UsVUFBVyxFQUVwQkMsV0FBVyxLQUNWakMsRUFBRThCLE9BQU9FLFVBQVcsRUFDcEJFLGtCQUVBaEYsa0JBQWtCLGVBQWdCdUUsYUFBY3RFLEdBQ2hERCxrQkFBa0IsWUFBWSxFQUFNQyxHQUNwQ2dGLE9BQU9DLFNBQVM3RCxLQUFPLGlCQUNyQixRQUlFb0MsR0FHUixNQUFNYSxzQkFBd0IsQ0FDN0J4QixFQUNBa0IsRUFDQUUsRUFDQWlCLEVBQ0FDLEVBQ0E3QixFQUNBQyxFQUNBYSxLQUVBdkIsRUFBRXVDLGlCQUVpQyxLQUEvQnJCLEVBQWNzQixNQUFNQyxRQUFnRCxLQUEvQnJCLEVBQWNvQixNQUFNQyxRQUM1RGxCLEVBQVNLLFVBQVVjLElBQUksV0FDdkJuQixFQUFTMUMsWUFBY3dELEVBQ2hCQSxHQUVQbkIsRUFBY3NCLE1BQU1DLFNBQVdoQyxHQUMvQlcsRUFBY29CLE1BQU1DLFNBQVcvQixHQUUvQlYsRUFBRThCLE9BQU9FLFVBQVcsRUFDcEJoQyxFQUFFOEIsT0FBT2hELE9BQU9pRCxtQkFDaEJSLEVBQVNLLFVBQVVDLE9BQU8sV0FFMUJJLFdBQVcsS0FDVlYsRUFBU0ssVUFBVWMsSUFBSSxXQUN2Qm5CLEVBQVMxQyxZQUFjeUQsRUFFdkJ0QyxFQUFFOEIsT0FBT0UsVUFBVyxFQUVwQkUsbUJBQ0UsS0FDSUksR0FFQSxhQUlGLE1BQU1LLGNBQWdCLEtBQzVCLE1BQU1DLEVBQWMzRixjQUFjLE1BQU8sQ0FBQyxpQkFXMUMsT0FWQTJGLEVBQVlDLFVBQVkscW5CQVVqQkQsVUFFRCxNQUFNRSxjQUFnQixLQUM1QixNQUFNRixFQUFjRyxTQUFTQyxjQUFjLGlCQUMzQ0osR0FBYWYsaUJBR1AsTUFBTUUsZ0JBQWtCLEtBQzlCLE1BQU1hLEVBQWMzRixjQUFjLE1BQU8sQ0FBQyx1QkFZMUMsT0FYQTJGLEVBQVlDLFVBQVksNm1CQVdqQkQsVUFFRCxNQUFNVixnQkFBa0IsS0FDVmEsU0FBU0MsY0FBYyx1QkFDL0JuQixpQkFHTixNQUFNb0IsbUJBQXFCLEVBQ2pDQyxVQUNDekQsTUFBUVcsUUFBTytDLGtCQUNmcEYsTUFBUXFGLGdCQUFlQyxpQkFBZ0JDLHlCQUd4QyxNQUFNbkcsRUFBV0MsS0FBS0MsUUFBUUMsYUFBYUMsUUFBUSxhQUM3Q2dHLEVBQW1CcEcsR0FBVXFHLGFBRTdCQyxFQUFZVixTQUFTQyxjQUFjLGNBQ25DVSxFQUFtQnpHLGNBQWMsT0FBUSxDQUFDLGtCQUMxQzJELEVBQVUzRCxjQUFjLE1BQU8sQ0FBQyxZQUNoQzBHLEVBQWdCMUcsY0FBYyxLQUFNLENBQ3pDLGNBQ0EseUJBRUsyRyxFQUFjM0csY0FBYyxNQUFPLENBQUMsdUJBSTFDLEdBRkEwRyxFQUFjOUUsWUFBY3VCLEVBRXhCbUQsR0FBNkQsSUFBekNoRSxPQUFPQyxLQUFLK0QsR0FBa0JNLE9BQ3JELElBQUssTUFBTUMsS0FBT1AsRUFDakJLLEVBQVk5RSxPQUNYaUYsY0FBY1YsRUFBZ0JDLEVBQWtCQSxJQUtuRE0sRUFBWTlFLE9BQ1hrRixvQkFDQ1osRUFDQUQsRUFDQUUsRUFDQU8sRUFDQU4sRUFDQUEsSUFHRjFDLEVBQVE5QixPQUFPNkUsRUFBZUMsR0FDOUJGLEVBQWlCNUUsT0FBTzhCLEdBRXhCNkMsRUFBVTNFLE9BQU80RSxJQUdsQixNQUFNSyxjQUFnQixDQUFDRSxFQUFVQyxFQUFhQyxLQUM3QyxNQUFNaEgsRUFBV0MsS0FBS0MsUUFBUUMsYUFBYUMsUUFBUSxhQUM3QzZHLEVBQW1CakgsR0FBVXFHLGNBQWdCLEdBRW5ELElBQUlhLEVBSUosR0FBcUIsR0FBakI3RyxlQUFrRCxJQUE1QjRHLEVBQWlCUCxPQUFjLE9BRXpEckcsZ0JBQ0E2RyxFQUxlLENBQUMsVUFBVyxVQUFXLFdBS3ZCN0csZUFFZixNQUFNOEcsRUFBY3JILGNBQWMsTUFBTyxDQUFDLDJCQUNwQ3NILEVBQWdCdEgsY0FBYyxNQUFPLENBQUMsMEJBQ3RDb0csRUFBaUJwRyxjQUFjLFNBQVUsQ0FBQyxzQkFBdUIsQ0FDdEUsYUFBY2dILEVBQ2QsVUFBVyxnQkFBZ0J6RyxrQkFHdEJnSCxFQUFxQnZILGNBQWMsTUFBTyxDQUFDLDZCQUMzQ3dILEVBQWtCeEgsY0FBYyxRQUFTLENBQUMsdUJBQXdCLENBQ3ZFa0UsS0FBTSxPQUNOdUQsVUFBVSxFQUNWbEMsTUFDQzRCLEVBQWlCLGdCQUFnQjVHLGtCQUNqQyxpQkFBaUJBLGtCQUVibUgsRUFBa0IxSCxjQUN2QixTQUNBLENBQUMsNEJBQ0QsQ0FBRSxhQUFjaUgsSUFFWFUsRUFBbUIzSCxjQUFjLE1BQU8sQ0FBQyw0QkFBNkIsQ0FDM0V5QixNQUFPLEtBQ1BDLE9BQVEsS0FDUmtHLFFBQVMsT0FDVGhILElBQUssR0FDTFksSUFBSyx5QkFrQk4sR0FmQTRFLEVBQWVSLFVBQVksd1ZBTTNCUSxFQUFleEQsTUFBTWlGLGdCQUFrQlQsRUFFdkNFLEVBQWN6RixPQUFPdUUsR0FDckJzQixFQUFnQjdGLE9BQU84RixHQUN2QkosRUFBbUIxRixPQUFPMkYsRUFBaUJFLEdBQzNDTCxFQUFZeEYsT0FBT3lGLEVBQWVDLElBSTdCSixFQUFpQixnQkFBZ0I1RyxpQkFBa0IsQ0FDdkQsTUFBTXVILEVBQWtCLElBQ3BCWCxFQUNILENBQUMsZ0JBQWdCNUcsaUJBQWtCLGlCQUFpQkEsaUJBRXJETixrQkFBa0IsZUFBZ0I2SCxFQUFpQjVILEVBQ3BELENBV0EsT0FUQXdILEVBQWdCNUUsaUJBQWlCLFFBQVVDLElBQzFDZ0YsYUFBYWhGLEVBQUd3RSxFQUFvQkwsS0FFckNNLEVBQWdCMUUsaUJBQWlCLFVBQVlDLElBQzlCLFVBQVZBLEVBQUU4RCxLQUNMbUIsYUFBYWpGLEtBSVJzRSxHQUdGTixvQkFBc0IsQ0FDM0JDLEVBQ0FpQixFQUNBQyxFQUNBdkIsRUFDQU0sRUFDQUMsS0FFQSxNQUFNaUIsRUFBZ0JuSSxjQUFjLE1BQU8sQ0FBQywrQkFDdENvSSxFQUFtQnBJLGNBQWMsTUFBTyxDQUFDLDBCQUN6Q21HLEVBQWdCbkcsY0FDckIsU0FDQSxDQUFDLHFCQUFzQixtQ0FDdkIsQ0FBRSxhQUFjZ0gsSUFFWHFCLEVBQXFCckksY0FBYyxNQUFPLENBQUMsMEJBQTJCLENBQzNFd0IsSUFBSyw4QkFDTG9HLFFBQVMsT0FDVGhILElBQUssS0FFQXNGLEVBQWlCbEcsY0FBYyxPQUFRLENBQUMsd0JBa0I5QyxPQWhCQWtHLEVBQWV0RSxZQUFjcUcsRUFFN0I5QixFQUFjdEUsT0FBT3dHLEdBQ3JCRCxFQUFpQnZHLE9BQU9zRSxHQUN4QmdDLEVBQWN0RyxPQUFPdUcsRUFBa0JsQyxHQUV2Q0MsRUFBY3JELGlCQUFpQixRQUFTLEtBQ3ZDLE1BQU13RixFQUFVeEIsY0FBY29CLEVBQWFqQixFQUFhQyxHQUVwRG9CLEVBQ0gzQixFQUFZOUUsT0FBT3lHLEdBRW5CQyxNQUFNLDRDQUlESixHQUdGSixhQUFlLENBQUNoRixFQUFHeUYsRUFBUXRCLEtBQ2hDdUIsb0JBQW9CMUYsR0FFcEIsTUFBTTJGLEVBQVUzRixFQUFFOEIsT0FDWjhELEVBQWFELEVBQVFFLHVCQUNyQkMsRUFBVUMsY0FBYzVCLEdBRTlCd0IsRUFBUS9ELFVBQVVjLElBQUksVUFDdEJvRCxFQUFRbEUsVUFBVUMsT0FBTyxVQUV6QjRELEVBQU8zRyxPQUFPZ0gsR0FFZEYsRUFBV0ksUUFDWEosRUFBV0ssU0FDWEwsRUFBV00sZ0JBQWdCLFlBQzNCTixFQUFXaEUsVUFBVWMsSUFBSSxXQUV6Qm9ELEVBQVEvRixpQkFBaUIsUUFBVUMsSUFDbENpRixhQUFhakYsTUFJVGlGLGFBQWdCakYsSUFDckIsTUFBTTdDLEVBQVdDLEtBQUtDLFFBQVFDLGFBQWFDLFFBQVEsYUFDN0M2RyxFQUFtQmpILEdBQVVxRyxjQUFnQixHQUc3QzJDLEVBRFVuRyxFQUFFOEIsT0FDYXNFLFFBQVEsMkJBQ2pDQyxFQUFtQkYsRUFBZW5ELGNBQWMsdUJBQ3BEckQsUUFBUTJHLEdBQ0pDLEVBQXFCSixFQUFlbkQsY0FDekMsd0JBR0QsR0FBd0MsS0FBcEN1RCxFQUFtQi9ELE1BQU1DLE9BQzVCLE9BQU8rQyxNQUFNLHVCQUVkLE1BQU1ULEVBQWtCLElBQ3BCWCxFQUNIaUMsQ0FBQ0EsR0FBbUJFLEVBQW1CL0QsT0FFeEN0RixrQkFBa0IsZUFBZ0I2SCxFQUFpQjVILEdBRW5EdUksb0JBQW9CMUYsSUFHZitGLGNBQWlCNUIsSUFDdEIsTUFBTXFDLEVBQWtCdkosY0FDdkIsU0FDQSxDQUFDLDJCQUE0QixVQUM3QixDQUFFLGFBQWNrSCxJQUVYc0MsRUFBbUJ4SixjQUFjLE1BQU8sQ0FBQyw0QkFBNkIsQ0FDM0V5QixNQUFPLEtBQ1BDLE9BQVEsS0FDUmtHLFFBQVMsT0FDVGhILElBQUssR0FDTFksSUFBSyx5QkFLTixPQUZBK0gsRUFBZ0IxSCxPQUFPMkgsR0FFaEJELEdBR0ZkLG9CQUF1QjFGLElBQzVCLE1BQU0yRixFQUFVM0YsRUFBRThCLE9BRVo0RSxFQUFlM0QsU0FBUzRELGlCQUFpQixZQUN6Q0MsRUFBYzdELFNBQVM0RCxpQkFBaUIsNkJBQ3hDRSxFQUFjOUQsU0FBUzRELGlCQUFpQiw2QkFFOUNELEVBQWFJLFFBQVNDLElBQ3JCQSxFQUFHQyxhQUFhLFlBQVksR0FDNUJELEVBQUduRixVQUFVQyxPQUFPLFdBQ3BCa0YsRUFBR0UsU0FFSkwsRUFBWUUsUUFBU0ksR0FBUUEsRUFBSXRGLFVBQVVjLElBQUksV0FDL0NtRSxFQUFZQyxRQUFTSSxHQUFRQSxFQUFJdEYsVUFBVUMsT0FBTyxXQUVsRDhELEVBQVEvRCxVQUFVYyxJQUFJIiwiaWdub3JlTGlzdCI6W10sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUVsZW1lbnQgfSBmcm9tIFwiLi9oZWxwZXJzLm1pbi5qc1wiO1xyXG5pbXBvcnQgeyBzZXRVc2VyUHJlZmVyZW5jZSB9IGZyb20gXCIuL3VwZGF0ZVN0YXRlRnVuY3Rpb25zLm1pbi5qc1wiO1xyXG5jb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2U/Lihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuXHJcbmxldCBwcm9maWxlc0NvdW50ID0gdXNlckRhdGE/LnByb2ZpbGVzQ291bnQgfHwgMDtcclxuY29uc3QgVVNFUk5BTUUgPSBcImhhbmRzb21lVXNlcjQwNFwiO1xyXG5jb25zdCBQQVNTV09SRCA9IFwiNWprc0g5ZC5cIjtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVMb2dpbkhlYWRlciA9IChcclxuXHR7XHJcblx0XHRoZWFkZXI6IHtcclxuXHRcdFx0YWx0OiB7IGxvZ28gfSxcclxuXHRcdFx0YXJpYTogeyBsb2dvTGluaywgY2hhbmdlTGFuZ3VhZ2VCdXR0b24gfSxcclxuXHRcdH0sXHJcblx0fSxcclxuXHRsYW5nQW1vdW50LFxyXG5cdGxhbmdOYW1lcyxcclxuXHRsYW5ndWFnZSxcclxuXHRoYW5kbGVMYW5nU2VsZWN0XHJcbikgPT4ge1xyXG5cdC8vIGxvZ29cclxuXHRjb25zdCBoZWFkZXIgPSBjcmVhdGVFbGVtZW50KFwiaGVhZGVyXCIsIFtcImhlYWRlclwiXSk7XHJcblx0Y29uc3QgcGFnZUxvZ28gPSBjcmVhdGVFbGVtZW50KFwiYVwiLCBbXCJoZWFkZXJfX2xvZ29cIiwgXCJsb2dpbi1oZWFkZXJfX2xvZ29cIl0sIHtcclxuXHRcdGhyZWY6IFwiL1wiLFxyXG5cdFx0XCJhcmlhLWxhYmVsXCI6IGAke2xvZ29MaW5rfWAsXHJcblx0fSk7XHJcblx0Y29uc3QgbG9nb0ltZyA9IGNyZWF0ZUVsZW1lbnQoXHJcblx0XHRcImltZ1wiLFxyXG5cdFx0W1wiaGVhZGVyX19sb2dvLWltZ1wiLCBcImxvZ2luLWhlYWRlcl9fbG9nby1pbWdcIl0sXHJcblx0XHR7XHJcblx0XHRcdHNyYzogXCIuL3NyYy9pY29ucy9sb2dvLnN2Z1wiLFxyXG5cdFx0XHRhbHQ6IGAke2xvZ299YCxcclxuXHRcdFx0d2lkdGg6IFwiMjRcIixcclxuXHRcdFx0aGVpZ2h0OiBcIjI0XCIsXHJcblx0XHR9XHJcblx0KTtcclxuXHRjb25zdCBsb2dvVGV4dCA9IGNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIFtcclxuXHRcdFwiaGVhZGVyX19sb2dvLXRleHRcIixcclxuXHRcdFwibG9naW4taGVhZGVyX19sb2dvLXRleHRcIixcclxuXHRdKTtcclxuXHRsb2dvVGV4dC50ZXh0Q29udGVudCA9IFwiU3RyZWFtXCI7XHJcblx0cGFnZUxvZ28uYXBwZW5kKGxvZ29JbWcsIGxvZ29UZXh0KTtcclxuXHRoZWFkZXIuYXBwZW5kKHBhZ2VMb2dvKTtcclxuXHQvLyBlbmQgb2YgbG9nb1xyXG5cclxuXHQvLyBsYW5ndWFnZSBzZWxlY3RvclxyXG5cdGNvbnN0IGxhbmdTZWxlY3QgPSBjcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIsIFtcImxvZ2luLWhlYWRlcl9fbGFuZy1zZWxlY3RcIl0sIHtcclxuXHRcdFwiYXJpYS1sYWJlbFwiOiBgJHtjaGFuZ2VMYW5ndWFnZUJ1dHRvbn1gLFxyXG5cdH0pO1xyXG5cdGNvbnN0IGxhbmdQbGF0Zm9ybUxhbmcgPSBjcmVhdGVFbGVtZW50KFwic3BhblwiLCBbXHJcblx0XHRcImxvZ2luLWhlYWRlcl9fbGFuZy1wbGF0Zm9ybS1sYW5nXCIsXHJcblx0XSk7XHJcblx0Y29uc3QgbGFuZ0Fycm93ID0gY3JlYXRlRWxlbWVudChcImltZ1wiLCBbXCJsb2dpbi1oZWFkZXJfX2xhbmctYXJyb3dcIl0sIHtcclxuXHRcdHNyYzogXCIuL3NyYy9pY29ucy9jaGV2cm9uLWRvd24uc3ZnXCIsXHJcblx0XHRhbHQ6IFwiXCIsXHJcblx0XHR3aWR0aDogXCIyNFwiLFxyXG5cdFx0aGVpZ2h0OiBcIjI0XCIsXHJcblx0fSk7XHJcblx0Y29uc3QgbGFuZ0xpc3QgPSBjcmVhdGVFbGVtZW50KFwidWxcIiwgW1wibG9naW4taGVhZGVyX19sYW5nLWxpc3RcIl0pO1xyXG5cclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGxhbmdBbW91bnQ7IGkrKykge1xyXG5cdFx0Y29uc3QgbGFuZ0Nob2ljZSA9IGNyZWF0ZUVsZW1lbnQoXCJsaVwiLCBbXCJsb2dpbi1oZWFkZXJfX2xhbmctY2hvaWNlXCJdLCB7XHJcblx0XHRcdHRhYmluZGV4OiAwLFxyXG5cdFx0fSk7XHJcblx0XHRjb25zdCBkYXRhID0gT2JqZWN0LmtleXMobGFuZ05hbWVzKVtpXTtcclxuXHRcdGNvbnN0IHRleHQgPSBPYmplY3QudmFsdWVzKGxhbmdOYW1lcylbaV07XHJcblxyXG5cdFx0bGFuZ0Nob2ljZS5kYXRhc2V0LmxhbmcgPSBkYXRhO1xyXG5cdFx0bGFuZ0Nob2ljZS50ZXh0Q29udGVudCA9IHRleHQ7XHJcblx0XHRsYW5nQ2hvaWNlLnN0eWxlLmFuaW1hdGlvbkRlbGF5ID0gaSAqIDEwMCArIFwibXNcIjtcclxuXHRcdGxhbmdMaXN0LmFwcGVuZChsYW5nQ2hvaWNlKTtcclxuXHR9XHJcblxyXG5cdGxhbmdQbGF0Zm9ybUxhbmcudGV4dENvbnRlbnQgPSBsYW5nTmFtZXNbbGFuZ3VhZ2VdO1xyXG5cclxuXHRsYW5nU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0aGFuZGxlTGFuZ1NlbGVjdC5jYWxsKGxhbmdTZWxlY3QsIGUsIGxhbmdQbGF0Zm9ybUxhbmcpO1xyXG5cdH0pO1xyXG5cclxuXHRsYW5nU2VsZWN0LmFwcGVuZChsYW5nUGxhdGZvcm1MYW5nLCBsYW5nQXJyb3csIGxhbmdMaXN0KTtcclxuXHRoZWFkZXIuYXBwZW5kKGxhbmdTZWxlY3QpO1xyXG5cclxuXHRyZXR1cm4gaGVhZGVyO1xyXG5cdC8vIGVuZCBvZiBsYW5ndWFnZSBzZWxlY3RvclxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUxvZ2luUGFnZSA9ICh7XHJcblx0bWFpbjoge1xyXG5cdFx0dGV4dDogeyB0aXRsZSwgc3VidGl0bGUsIGRlc2NyaXB0aW9uLCBidXR0b24gfSxcclxuXHRcdHBsYWNlaG9sZGVyOiB7IHVzZXJuYW1lLCBwYXNzd29yZCB9LFxyXG5cdH0sXHJcbn0pID0+IHtcclxuXHRjb25zdCBtYWluQ29udGVudCA9IGNyZWF0ZUVsZW1lbnQoXCJtYWluXCIsIFtcIm1haW5cIl0pO1xyXG5cdGNvbnN0IHdyYXBwZXIgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcIndyYXBwZXJcIl0pO1xyXG5cdGNvbnN0IGxvZ2luVGl0bGUgPSBjcmVhdGVFbGVtZW50KFwiaDFcIik7XHJcblx0Y29uc3QgbG9naW5UaXRsZVRvcCA9IGNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIFtcIm1haW5fX3RpdGxlXCJdKTtcclxuXHRjb25zdCBsb2dpblRpdGxlQm90dG9tID0gY3JlYXRlRWxlbWVudChcInNwYW5cIiwgW1wibWFpbl9fc3VidGl0bGVcIl0pO1xyXG5cdGNvbnN0IGxvZ2luVGV4dCA9IGNyZWF0ZUVsZW1lbnQoXCJwXCIsIFtcIm1haW5fX3RleHRcIl0pO1xyXG5cdGNvbnN0IGZvcm0gPSBjcmVhdGVFbGVtZW50KFwiZm9ybVwiLCBbXCJtYWluX19mb3JtXCJdKTtcclxuXHRjb25zdCB1c2VybmFtZUlucHV0ID0gY3JlYXRlRWxlbWVudChcclxuXHRcdFwiaW5wdXRcIixcclxuXHRcdFtcIm1haW5fX2Zvcm0taW5wdXRcIiwgXCJtYWluX19mb3JtLWlucHV0LS11c2VybmFtZVwiXSxcclxuXHRcdHsgdHlwZTogXCJ0ZXh0XCIsIHBsYWNlaG9sZGVyOiB1c2VybmFtZSB9XHJcblx0KTtcclxuXHRjb25zdCBwYXNzd29yZElucHV0ID0gY3JlYXRlRWxlbWVudChcclxuXHRcdFwiaW5wdXRcIixcclxuXHRcdFtcIm1haW5fX2Zvcm0taW5wdXRcIiwgXCJtYWluX19mb3JtLWlucHV0LS1wYXNzd29yZFwiXSxcclxuXHRcdHsgdHlwZTogXCJwYXNzd29yZFwiLCBwbGFjZWhvbGRlcjogcGFzc3dvcmQgfVxyXG5cdCk7XHJcblx0Y29uc3Qgc3VibWl0QnRuID0gY3JlYXRlRWxlbWVudChcImJ1dHRvblwiLCBbXCJtYWluX19mb3JtLWJ1dHRvblwiXSwge1xyXG5cdFx0dHlwZTogXCJzdWJtaXRcIixcclxuXHR9KTtcclxuXHRjb25zdCBidXR0b25UZXh0ID0gY3JlYXRlRWxlbWVudChcInNwYW5cIiwgW1wibWFpbl9fZm9ybS1idXR0b24tdGV4dFwiXSk7XHJcblxyXG5cdGNvbnN0IGVycm9yVHh0ID0gY3JlYXRlRWxlbWVudChcInBcIiwgW1wibWFpbl9fZm9ybS1lcnJvci10eHRcIl0pO1xyXG5cdGxvZ2luVGl0bGVUb3AudGV4dENvbnRlbnQgPSB0aXRsZTtcclxuXHRsb2dpblRpdGxlQm90dG9tLnRleHRDb250ZW50ID0gc3VidGl0bGU7XHJcblx0bG9naW5UZXh0LnRleHRDb250ZW50ID0gZGVzY3JpcHRpb247XHJcblx0YnV0dG9uVGV4dC50ZXh0Q29udGVudCA9IGJ1dHRvbjtcclxuXHJcblx0bG9naW5UaXRsZS5hcHBlbmQobG9naW5UaXRsZVRvcCwgbG9naW5UaXRsZUJvdHRvbSk7XHJcblx0c3VibWl0QnRuLmFwcGVuZChidXR0b25UZXh0KTtcclxuXHRmb3JtLmFwcGVuZCh1c2VybmFtZUlucHV0LCBwYXNzd29yZElucHV0LCBzdWJtaXRCdG4sIGVycm9yVHh0KTtcclxuXHJcblx0d3JhcHBlci5hcHBlbmQobG9naW5UaXRsZSwgbG9naW5UZXh0LCBmb3JtKTtcclxuXHRtYWluQ29udGVudC5hcHBlbmQod3JhcHBlcik7XHJcblxyXG5cdHN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuXHRcdGNvbnN0IHVzZXJEYXRhID0gSlNPTi5wYXJzZT8uKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlckRhdGFcIikpO1xyXG5cclxuXHRcdGNvbnN0IHJlc3VsdHMgPSBoYW5kbGVMb2dpblZhbGlkYXRpb24oXHJcblx0XHRcdGUsXHJcblx0XHRcdHVzZXJuYW1lSW5wdXQsXHJcblx0XHRcdHBhc3N3b3JkSW5wdXQsXHJcblx0XHRcdHRyYW5zbGF0aW9ucy5tYWluLnRleHQuZXJyb3JSZXF1aXJlZCxcclxuXHRcdFx0dHJhbnNsYXRpb25zLm1haW4udGV4dC5lcnJvckludmFsaWQsXHJcblx0XHRcdFVTRVJOQU1FLFxyXG5cdFx0XHRQQVNTV09SRCxcclxuXHRcdFx0ZXJyb3JUeHRcclxuXHRcdCk7XHJcblxyXG5cdFx0aWYgKCFyZXN1bHRzKSB7XHJcblx0XHRcdGVycm9yVHh0LmNsYXNzTGlzdC5yZW1vdmUoXCJ2aXNpYmxlXCIpO1xyXG5cdFx0XHRlLnRhcmdldC5hcHBlbmQoc2hvd1NtYWxsTG9hZGVyKCkpO1xyXG5cdFx0XHRlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7XHJcblxyXG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0XHRlLnRhcmdldC5kaXNhYmxlZCA9IGZhbHNlO1xyXG5cdFx0XHRcdGhpZGVTbWFsbExvYWRlcigpO1xyXG5cclxuXHRcdFx0XHRzZXRVc2VyUHJlZmVyZW5jZShcInRyYW5zbGF0aW9uc1wiLCB0cmFuc2xhdGlvbnMsIHVzZXJEYXRhKTtcclxuXHRcdFx0XHRzZXRVc2VyUHJlZmVyZW5jZShcImxvZ2dlZEluXCIsIHRydWUsIHVzZXJEYXRhKTtcclxuXHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwicHJvZmlsZXMuaHRtbFwiOyAvLyBwcnplasWbY2llIG5hIHN0cm9uxJkgeiBwcm9maWxhbWlcclxuXHRcdFx0fSwgMzAwMCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdHJldHVybiBtYWluQ29udGVudDtcclxufTtcclxuXHJcbmNvbnN0IGhhbmRsZUxvZ2luVmFsaWRhdGlvbiA9IChcclxuXHRlLFxyXG5cdHVzZXJuYW1lSW5wdXQsXHJcblx0cGFzc3dvcmRJbnB1dCxcclxuXHRyZXF1aXJlRXJyb3IsXHJcblx0aW52YWxpZEVycm9yLFxyXG5cdHVzZXJuYW1lLFxyXG5cdHBhc3N3b3JkLFxyXG5cdGVycm9yVHh0XHJcbikgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0aWYgKHVzZXJuYW1lSW5wdXQudmFsdWUudHJpbSgpID09PSBcIlwiIHx8IHBhc3N3b3JkSW5wdXQudmFsdWUudHJpbSgpID09PSBcIlwiKSB7XHJcblx0XHRlcnJvclR4dC5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcclxuXHRcdGVycm9yVHh0LnRleHRDb250ZW50ID0gcmVxdWlyZUVycm9yO1xyXG5cdFx0cmV0dXJuIHJlcXVpcmVFcnJvcjtcclxuXHR9IGVsc2UgaWYgKFxyXG5cdFx0dXNlcm5hbWVJbnB1dC52YWx1ZS50cmltKCkgIT09IHVzZXJuYW1lIHx8XHJcblx0XHRwYXNzd29yZElucHV0LnZhbHVlLnRyaW0oKSAhPT0gcGFzc3dvcmRcclxuXHQpIHtcclxuXHRcdGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTtcclxuXHRcdGUudGFyZ2V0LmFwcGVuZChzaG93U21hbGxMb2FkZXIoKSk7XHJcblx0XHRlcnJvclR4dC5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaWJsZVwiKTtcclxuXHJcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0ZXJyb3JUeHQuY2xhc3NMaXN0LmFkZChcInZpc2libGVcIik7XHJcblx0XHRcdGVycm9yVHh0LnRleHRDb250ZW50ID0gaW52YWxpZEVycm9yO1xyXG5cclxuXHRcdFx0ZS50YXJnZXQuZGlzYWJsZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdGhpZGVTbWFsbExvYWRlcigpO1xyXG5cdFx0fSwgMzAwMCk7XHJcblx0XHRyZXR1cm4gaW52YWxpZEVycm9yO1xyXG5cdH0gZWxzZSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2hvd0JpZ0xvYWRlciA9ICgpID0+IHtcclxuXHRjb25zdCBsb2FkaW5nQXJlYSA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibG9hZGluZy1hcmVhXCJdKTtcclxuXHRsb2FkaW5nQXJlYS5pbm5lckhUTUwgPSBgICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImxvYWRlci1iaWdcIiB2aWV3Qm94PVwiMCAwIDEyMCAxMjBcIiB3aWR0aD1cIjEyMFwiIGhlaWdodD1cIjEyMFwiPlxyXG4gICAgICAgICAgICAgICAgPGRlZnM+XHJcbiAgICAgICAgICAgICAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPVwibG9hZGVyLWFjY2VudFwiIHgxPVwiMCVcIiB5MT1cIjAlXCIgeDI9XCIxMDAlXCIgeTI9XCIwJVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9XCIwJVwiIHN0b3AtY29sb3I9XCIjNGRhOGRhXCIgc3RvcC1vcGFjaXR5PVwiMC44XCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHN0b3Agb2Zmc2V0PVwiNzAlXCIgc3RvcC1jb2xvcj1cIiM0ZGE4ZGFcIiBzdG9wLW9wYWNpdHk9XCIwLjRcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9XCIxMDAlXCIgc3RvcC1jb2xvcj1cIiM0ZGE4ZGFcIiBzdG9wLW9wYWNpdHk9XCIwXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICA8L2xpbmVhckdyYWRpZW50PlxyXG4gICAgICAgICAgICAgICAgPC9kZWZzPlxyXG4gICAgICAgICAgICAgICAgPGNpcmNsZSBjbGFzcz1cImxvYWRpbmctY2lyY2xlLWJpZ1wiIHI9XCIzNVwiIGN4PVwiNjBcIiBjeT1cIjYwXCI+PC9jaXJjbGU+XHJcbiAgICAgICAgICAgIDwvc3ZnPmA7XHJcblx0cmV0dXJuIGxvYWRpbmdBcmVhO1xyXG59O1xyXG5leHBvcnQgY29uc3QgaGlkZUJpZ0xvYWRlciA9ICgpID0+IHtcclxuXHRjb25zdCBsb2FkaW5nQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGluZy1hcmVhXCIpO1xyXG5cdGxvYWRpbmdBcmVhPy5yZW1vdmUoKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzaG93U21hbGxMb2FkZXIgPSAoKSA9PiB7XHJcblx0Y29uc3QgbG9hZGluZ0FyZWEgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcImxvYWRpbmctYXJlYS1zbWFsbFwiXSk7XHJcblx0bG9hZGluZ0FyZWEuaW5uZXJIVE1MID0gYDxzdmcgY2xhc3M9XCJsb2FkZXItc21hbGxcIiB2aWV3Qm94PVwiMCAwIDEyMCAxMjBcIiB3aWR0aD1cIjEyMFwiIGhlaWdodD1cIjEyMFwiPlxyXG4gICAgICAgICAgICAgICAgPGRlZnM+XHJcbiAgICAgICAgICAgICAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPVwibG9hZGVyLWFjY2VudC1zbWFsbFwiIHgxPVwiMCVcIiB5MT1cIjAlXCIgeDI9XCIxMDAlXCIgeTI9XCIwJVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3RvcCBvZmZzZXQ9XCIwJVwiIHN0b3AtY29sb3I9XCJ3aGl0ZVwiIHN0b3Atb3BhY2l0eT1cIjAuOFwiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD1cIjcwJVwiIHN0b3AtY29sb3I9XCJ3aGl0ZVwiIHN0b3Atb3BhY2l0eT1cIjAuM1wiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzdG9wIG9mZnNldD1cIjEwMCVcIiBzdG9wLWNvbG9yPVwid2hpdGVcIiBzdG9wLW9wYWNpdHk9XCIwXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICA8L2xpbmVhckdyYWRpZW50PlxyXG4gICAgICAgICAgICAgICAgPC9kZWZzPlxyXG4gICAgICAgICAgICAgICAgPGNpcmNsZSBjbGFzcz1cImxvYWRpbmctY2lyY2xlLXNtYWxsXCIgcj1cIjEyXCIgY3g9XCI2MFwiIGN5PVwiNjBcIj48L2NpcmNsZT5cclxuICAgICAgICAgICAgPC9zdmc+YDtcclxuXHJcblx0cmV0dXJuIGxvYWRpbmdBcmVhO1xyXG59O1xyXG5leHBvcnQgY29uc3QgaGlkZVNtYWxsTG9hZGVyID0gKCkgPT4ge1xyXG5cdGNvbnN0IGxvYWRpbmdBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5sb2FkaW5nLWFyZWEtc21hbGxcIik7XHJcblx0bG9hZGluZ0FyZWEucmVtb3ZlKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlUHJvZmlsZXNQYWdlID0gKHtcclxuXHRwcm9maWxlczoge1xyXG5cdFx0dGV4dDogeyB0aXRsZSwgYWRkUHJvZmlsZUluZm8gfSxcclxuXHRcdGFyaWE6IHsgYWRkUHJvZmlsZUJ0biwgdXNlclByb2ZpbGVCdG4sIHVzZXJCdG5DdXN0b21pemUgfSxcclxuXHR9LFxyXG59KSA9PiB7XHJcblx0Y29uc3QgdXNlckRhdGEgPSBKU09OLnBhcnNlPy4obG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ1c2VyRGF0YVwiKSk7XHJcblx0Y29uc3QgdXNlclByb2ZpbGVzTGlzdCA9IHVzZXJEYXRhPy51c2VyUHJvZmlsZXM7XHJcblxyXG5cdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyXCIpO1xyXG5cdGNvbnN0IHByb2ZpbGVzUGFnZU1haW4gPSBjcmVhdGVFbGVtZW50KFwibWFpblwiLCBbXCJtYWluLXByb2ZpbGVzXCJdKTtcclxuXHRjb25zdCB3cmFwcGVyID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJ3cmFwcGVyXCJdKTtcclxuXHRjb25zdCBwcm9maWxlc1RpdGxlID0gY3JlYXRlRWxlbWVudChcImgxXCIsIFtcclxuXHRcdFwibWFpbl9fdGl0bGVcIixcclxuXHRcdFwibWFpbi1wcm9maWxlc19fdGl0bGVcIixcclxuXHRdKTtcclxuXHRjb25zdCBwcm9maWxlc0JveCA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibWFpbi1wcm9maWxlc19fYm94XCJdKTtcclxuXHJcblx0cHJvZmlsZXNUaXRsZS50ZXh0Q29udGVudCA9IHRpdGxlO1xyXG5cclxuXHRpZiAodXNlclByb2ZpbGVzTGlzdCAmJiBPYmplY3Qua2V5cyh1c2VyUHJvZmlsZXNMaXN0KS5sZW5ndGggIT09IDApIHtcclxuXHRcdGZvciAoY29uc3Qga2V5IGluIHVzZXJQcm9maWxlc0xpc3QpIHtcclxuXHRcdFx0cHJvZmlsZXNCb3guYXBwZW5kKFxyXG5cdFx0XHRcdGNyZWF0ZVByb2ZpbGUodXNlclByb2ZpbGVCdG4sIHVzZXJCdG5DdXN0b21pemUsIHVzZXJCdG5DdXN0b21pemUpXHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwcm9maWxlc0JveC5hcHBlbmQoXHJcblx0XHRjcmVhdGVQcm9maWxlQWRkQnRuKFxyXG5cdFx0XHRhZGRQcm9maWxlQnRuLFxyXG5cdFx0XHRhZGRQcm9maWxlSW5mbyxcclxuXHRcdFx0dXNlclByb2ZpbGVCdG4sXHJcblx0XHRcdHByb2ZpbGVzQm94LFxyXG5cdFx0XHR1c2VyQnRuQ3VzdG9taXplLFxyXG5cdFx0XHR1c2VyQnRuQ3VzdG9taXplXHJcblx0XHQpXHJcblx0KTtcclxuXHR3cmFwcGVyLmFwcGVuZChwcm9maWxlc1RpdGxlLCBwcm9maWxlc0JveCk7XHJcblx0cHJvZmlsZXNQYWdlTWFpbi5hcHBlbmQod3JhcHBlcik7XHJcblxyXG5cdGNvbnRhaW5lci5hcHBlbmQocHJvZmlsZXNQYWdlTWFpbik7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVQcm9maWxlID0gKGFyaWFJbmZvLCB1c2VyQnRuSW5mbywgc2F2ZUJ0bkFyaWEpID0+IHtcclxuXHRjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2U/Lihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuXHRjb25zdCBleGlzdGluZ1Byb2ZpbGVzID0gdXNlckRhdGE/LnVzZXJQcm9maWxlcyB8fCBbXTtcclxuXHJcblx0bGV0IGNvbG9yO1xyXG5cclxuXHRjb25zdCBjb2xvcnMgPSBbXCIjZGM0YTM0XCIsIFwiIzA2MkU2M1wiLCBcIiNGQUMwNDRcIl07XHJcblxyXG5cdGlmIChwcm9maWxlc0NvdW50ID09IDMgfHwgZXhpc3RpbmdQcm9maWxlcy5sZW5ndGggPT09IDMpIHJldHVybjtcclxuXHJcblx0cHJvZmlsZXNDb3VudCsrO1xyXG5cdGNvbG9yID0gY29sb3JzW3Byb2ZpbGVzQ291bnRdO1xyXG5cclxuXHRjb25zdCB1c2VyUHJvZmlsZSA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibWFpbi1wcm9maWxlc19fcHJvZmlsZVwiXSk7XHJcblx0Y29uc3QgdXNlckF2YXRhckJveCA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgW1wibWFpbi1wcm9maWxlc19fYXZhdGFyXCJdKTtcclxuXHRjb25zdCB1c2VyUHJvZmlsZUJ0biA9IGNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiwgW1wibWFpbi1wcm9maWxlc19fYnRuXCJdLCB7XHJcblx0XHRcImFyaWEtbGFiZWxcIjogYXJpYUluZm8sXHJcblx0XHRcImRhdGEtaWRcIjogYHVzZXItcHJvZmlsZS0ke3Byb2ZpbGVzQ291bnR9YCxcclxuXHR9KTtcclxuXHJcblx0Y29uc3QgdXNlclByb2ZpbGVJbmZvQm94ID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJtYWluLXByb2ZpbGVzX191c2VyLWluZm9cIl0pO1xyXG5cdGNvbnN0IHVzZXJQcm9maWxlSW5mbyA9IGNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCBbXCJtYWluLXByb2ZpbGVzX19uYW1lXCJdLCB7XHJcblx0XHR0eXBlOiBcInRleHRcIixcclxuXHRcdHJlYWRvbmx5OiB0cnVlLFxyXG5cdFx0dmFsdWU6XHJcblx0XHRcdGV4aXN0aW5nUHJvZmlsZXNbYHVzZXItcHJvZmlsZS0ke3Byb2ZpbGVzQ291bnR9YF0gfHxcclxuXHRcdFx0YEhhbmRzb21lIFVzZXIgJHtwcm9maWxlc0NvdW50fWAsXHJcblx0fSk7XHJcblx0Y29uc3QgZWRpdFVzZXJJbmZvQnRuID0gY3JlYXRlRWxlbWVudChcclxuXHRcdFwiYnV0dG9uXCIsXHJcblx0XHRbXCJtYWluLXByb2ZpbGVzX19lZGl0LW5hbWVcIl0sXHJcblx0XHR7IFwiYXJpYS1sYWJlbFwiOiB1c2VyQnRuSW5mbyB9XHJcblx0KTtcclxuXHRjb25zdCBlZGl0VXNlckluZm9JY29uID0gY3JlYXRlRWxlbWVudChcImltZ1wiLCBbXCJtYWluLXByb2ZpbGVzX19lZGl0LWljb25cIl0sIHtcclxuXHRcdHdpZHRoOiBcIjI0XCIsXHJcblx0XHRoZWlnaHQ6IFwiMjRcIixcclxuXHRcdGxvYWRpbmc6IFwibGF6eVwiLFxyXG5cdFx0YWx0OiBcIlwiLFxyXG5cdFx0c3JjOiBcIi4vc3JjL2ljb25zL2VkaXQuc3ZnXCIsXHJcblx0fSk7XHJcblxyXG5cdHVzZXJQcm9maWxlQnRuLmlubmVySFRNTCA9IGA8c3ZnIGNsYXNzPVwibWFpbi1wcm9maWxlc19faW1nXCIgd2lkdGg9XCIxNTBcIiBoZWlnaHQ9XCIxNTBcIiB2aWV3Qm94PVwiMCAwIDIwMCAyMDBcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XHJcblx0PGNpcmNsZSBjeD1cIjcwXCIgY3k9XCI3MFwiIHI9XCI4XCIgZmlsbD1cIndoaXRlXCIgLz5cclxuXHQ8Y2lyY2xlIGN4PVwiMTMwXCIgY3k9XCI3MFwiIHI9XCI4XCIgZmlsbD1cIndoaXRlXCIgLz5cclxuXHQ8cGF0aCBkPVwiTTYwIDExMCBRMTAwIDE1MCAxNDAgMTEwXCIgc3Ryb2tlPVwid2hpdGVcIiBzdHJva2Utd2lkdGg9XCI2XCJcclxuXHRmaWxsPVwidHJhbnNwYXJlbnRcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgLz5cclxuXHQ8L3N2Zz5gO1xyXG5cdHVzZXJQcm9maWxlQnRuLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xyXG5cclxuXHR1c2VyQXZhdGFyQm94LmFwcGVuZCh1c2VyUHJvZmlsZUJ0bik7XHJcblx0ZWRpdFVzZXJJbmZvQnRuLmFwcGVuZChlZGl0VXNlckluZm9JY29uKTtcclxuXHR1c2VyUHJvZmlsZUluZm9Cb3guYXBwZW5kKHVzZXJQcm9maWxlSW5mbywgZWRpdFVzZXJJbmZvQnRuKTtcclxuXHR1c2VyUHJvZmlsZS5hcHBlbmQodXNlckF2YXRhckJveCwgdXNlclByb2ZpbGVJbmZvQm94KTtcclxuXHJcblx0Ly8gc2V0VXNlclByZWZlcmVuY2UoXCJwcm9maWxlc0NvdW50XCIsIHByb2ZpbGVzQ291bnQsIHVzZXJEYXRhKVxyXG5cclxuXHRpZiAoIWV4aXN0aW5nUHJvZmlsZXNbYHVzZXItcHJvZmlsZS0ke3Byb2ZpbGVzQ291bnR9YF0pIHtcclxuXHRcdGNvbnN0IHVwZGF0ZWRQcm9maWxlcyA9IHtcclxuXHRcdFx0Li4uZXhpc3RpbmdQcm9maWxlcyxcclxuXHRcdFx0W2B1c2VyLXByb2ZpbGUtJHtwcm9maWxlc0NvdW50fWBdOiBgSGFuZHNvbWUgVXNlciAke3Byb2ZpbGVzQ291bnR9YCxcclxuXHRcdH07XHJcblx0XHRzZXRVc2VyUHJlZmVyZW5jZShcInVzZXJQcm9maWxlc1wiLCB1cGRhdGVkUHJvZmlsZXMsIHVzZXJEYXRhKTtcclxuXHR9XHJcblxyXG5cdGVkaXRVc2VySW5mb0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuXHRcdGVkaXRVc2VybmFtZShlLCB1c2VyUHJvZmlsZUluZm9Cb3gsIHNhdmVCdG5BcmlhKTtcclxuXHR9KTtcclxuXHR1c2VyUHJvZmlsZUluZm8uYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcclxuXHRcdGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XHJcblx0XHRcdHNhdmVVc2VybmFtZShlKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIHVzZXJQcm9maWxlO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlUHJvZmlsZUFkZEJ0biA9IChcclxuXHRhcmlhSW5mbyxcclxuXHRpbmZvLFxyXG5cdHVzZXJCdG5BcmlhLFxyXG5cdHByb2ZpbGVzQm94LFxyXG5cdHVzZXJCdG5JbmZvLFxyXG5cdHNhdmVCdG5BcmlhXHJcbikgPT4ge1xyXG5cdGNvbnN0IGFkZFByb2ZpbGVCb3ggPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFtcIm1haW4tcHJvZmlsZXNfX2FkZC1wcm9maWxlXCJdKTtcclxuXHRjb25zdCBhZGRQcm9maWxlQXZhdGFyID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBbXCJtYWluLXByb2ZpbGVzX19hdmF0YXJcIl0pO1xyXG5cdGNvbnN0IGFkZFByb2ZpbGVCdG4gPSBjcmVhdGVFbGVtZW50KFxyXG5cdFx0XCJidXR0b25cIixcclxuXHRcdFtcIm1haW4tcHJvZmlsZXNfX2J0blwiLCBcIm1haW4tcHJvZmlsZXNfX2J0bi0tYWRkLXByb2ZpbGVcIl0sXHJcblx0XHR7IFwiYXJpYS1sYWJlbFwiOiBhcmlhSW5mbyB9XHJcblx0KTtcclxuXHRjb25zdCBhZGRQcm9maWxlUGx1c0ljb24gPSBjcmVhdGVFbGVtZW50KFwiaW1nXCIsIFtcIm1haW4tcHJvZmlsZXNfX2FkZC1pbWdcIl0sIHtcclxuXHRcdHNyYzogXCIuL3NyYy9pY29ucy9hZGQtcHJvZmlsZS5zdmdcIixcclxuXHRcdGxvYWRpbmc6IFwibGF6eVwiLFxyXG5cdFx0YWx0OiBcIlwiLFxyXG5cdH0pO1xyXG5cdGNvbnN0IGFkZFByb2ZpbGVJbmZvID0gY3JlYXRlRWxlbWVudChcInNwYW5cIiwgW1wibWFpbi1wcm9maWxlc19fbmFtZVwiXSk7XHJcblxyXG5cdGFkZFByb2ZpbGVJbmZvLnRleHRDb250ZW50ID0gaW5mbztcclxuXHJcblx0YWRkUHJvZmlsZUJ0bi5hcHBlbmQoYWRkUHJvZmlsZVBsdXNJY29uKTtcclxuXHRhZGRQcm9maWxlQXZhdGFyLmFwcGVuZChhZGRQcm9maWxlQnRuKTtcclxuXHRhZGRQcm9maWxlQm94LmFwcGVuZChhZGRQcm9maWxlQXZhdGFyLCBhZGRQcm9maWxlSW5mbyk7XHJcblxyXG5cdGFkZFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuXHRcdGNvbnN0IHByb2ZpbGUgPSBjcmVhdGVQcm9maWxlKHVzZXJCdG5BcmlhLCB1c2VyQnRuSW5mbywgc2F2ZUJ0bkFyaWEpO1xyXG5cclxuXHRcdGlmIChwcm9maWxlKSB7XHJcblx0XHRcdHByb2ZpbGVzQm94LmFwcGVuZChwcm9maWxlKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGFsZXJ0KFwiT3NpxIVnbmnEmXRvIG1ha3N5bWFsbsSFIGxpY3pixJkgcHJvZmlsw7N3IVwiKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIGFkZFByb2ZpbGVCb3g7XHJcbn07XHJcblxyXG5jb25zdCBlZGl0VXNlcm5hbWUgPSAoZSwgcGFyZW50LCBzYXZlQnRuQXJpYSkgPT4ge1xyXG5cdHJlc2V0U3RhdGVPZkVkaXRpbmcoZSk7XHJcblxyXG5cdGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldDtcclxuXHRjb25zdCBuYW1lVG9FZGl0ID0gZWRpdEJ0bi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG5cdGNvbnN0IHNhdmVCdG4gPSBjcmVhdGVTYXZlQnRuKHNhdmVCdG5BcmlhKTtcclxuXHJcblx0ZWRpdEJ0bi5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG5cdHNhdmVCdG4uY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcclxuXHJcblx0cGFyZW50LmFwcGVuZChzYXZlQnRuKTtcclxuXHJcblx0bmFtZVRvRWRpdC5mb2N1cygpO1xyXG5cdG5hbWVUb0VkaXQuc2VsZWN0KCk7XHJcblx0bmFtZVRvRWRpdC5yZW1vdmVBdHRyaWJ1dGUoXCJyZWFkb25seVwiKTtcclxuXHRuYW1lVG9FZGl0LmNsYXNzTGlzdC5hZGQoXCJmb2N1c2VkXCIpO1xyXG5cclxuXHRzYXZlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0c2F2ZVVzZXJuYW1lKGUpO1xyXG5cdH0pO1xyXG59O1xyXG5cclxuY29uc3Qgc2F2ZVVzZXJuYW1lID0gKGUpID0+IHtcclxuXHRjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2U/Lihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJEYXRhXCIpKTtcclxuXHRjb25zdCBleGlzdGluZ1Byb2ZpbGVzID0gdXNlckRhdGE/LnVzZXJQcm9maWxlcyB8fCBbXTtcclxuXHJcblx0Y29uc3Qgc2F2ZUJ0biA9IGUudGFyZ2V0O1xyXG5cdGNvbnN0IGNsb3Nlc3RQcm9maWxlID0gc2F2ZUJ0bi5jbG9zZXN0KFwiLm1haW4tcHJvZmlsZXNfX3Byb2ZpbGVcIik7XHJcblx0Y29uc3QgY2xvc2VzdFByb2ZpbGVJZCA9IGNsb3Nlc3RQcm9maWxlLnF1ZXJ5U2VsZWN0b3IoXCIubWFpbi1wcm9maWxlc19fYnRuXCIpXHJcblx0XHQuZGF0YXNldC5pZDtcclxuXHRjb25zdCBjbG9zZXN0UHJvZmlsZU5hbWUgPSBjbG9zZXN0UHJvZmlsZS5xdWVyeVNlbGVjdG9yKFxyXG5cdFx0XCIubWFpbi1wcm9maWxlc19fbmFtZVwiXHJcblx0KTtcclxuXHJcblx0aWYgKGNsb3Nlc3RQcm9maWxlTmFtZS52YWx1ZS50cmltKCkgPT09IFwiXCIpXHJcblx0XHRyZXR1cm4gYWxlcnQoXCJOaWUgbW96ZSBiecSHIHB1c3RlIVwiKTtcclxuXHJcblx0Y29uc3QgdXBkYXRlZFByb2ZpbGVzID0ge1xyXG5cdFx0Li4uZXhpc3RpbmdQcm9maWxlcyxcclxuXHRcdFtjbG9zZXN0UHJvZmlsZUlkXTogY2xvc2VzdFByb2ZpbGVOYW1lLnZhbHVlLFxyXG5cdH07XHJcblx0c2V0VXNlclByZWZlcmVuY2UoXCJ1c2VyUHJvZmlsZXNcIiwgdXBkYXRlZFByb2ZpbGVzLCB1c2VyRGF0YSk7XHJcblxyXG5cdHJlc2V0U3RhdGVPZkVkaXRpbmcoZSk7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVTYXZlQnRuID0gKHNhdmVCdG5BcmlhKSA9PiB7XHJcblx0Y29uc3Qgc2F2ZVVzZXJJbmZvQnRuID0gY3JlYXRlRWxlbWVudChcclxuXHRcdFwiYnV0dG9uXCIsXHJcblx0XHRbXCJtYWluLXByb2ZpbGVzX19zYXZlLW5hbWVcIiwgXCJoaWRkZW5cIl0sXHJcblx0XHR7IFwiYXJpYS1sYWJlbFwiOiBzYXZlQnRuQXJpYSB9XHJcblx0KTtcclxuXHRjb25zdCBzYXZlVXNlckluZm9JY29uID0gY3JlYXRlRWxlbWVudChcImltZ1wiLCBbXCJtYWluLXByb2ZpbGVzX19zYXZlLWljb25cIl0sIHtcclxuXHRcdHdpZHRoOiBcIjI0XCIsXHJcblx0XHRoZWlnaHQ6IFwiMjRcIixcclxuXHRcdGxvYWRpbmc6IFwibGF6eVwiLFxyXG5cdFx0YWx0OiBcIlwiLFxyXG5cdFx0c3JjOiBcIi4vc3JjL2ljb25zL3NhdmUuc3ZnXCIsXHJcblx0fSk7XHJcblxyXG5cdHNhdmVVc2VySW5mb0J0bi5hcHBlbmQoc2F2ZVVzZXJJbmZvSWNvbik7XHJcblxyXG5cdHJldHVybiBzYXZlVXNlckluZm9CdG47XHJcbn07XHJcblxyXG5jb25zdCByZXNldFN0YXRlT2ZFZGl0aW5nID0gKGUpID0+IHtcclxuXHRjb25zdCBlZGl0QnRuID0gZS50YXJnZXQ7XHJcblxyXG5cdGNvbnN0IGZvY3VzZWROYW1lcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9jdXNlZFwiKTtcclxuXHRjb25zdCBhbGxTYXZlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWFpbi1wcm9maWxlc19fc2F2ZS1uYW1lXCIpO1xyXG5cdGNvbnN0IGFsbEVkaXRCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tYWluLXByb2ZpbGVzX19lZGl0LW5hbWVcIik7XHJcblxyXG5cdGZvY3VzZWROYW1lcy5mb3JFYWNoKChlbCkgPT4ge1xyXG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicmVhZG9ubHlcIiwgdHJ1ZSk7XHJcblx0XHRlbC5jbGFzc0xpc3QucmVtb3ZlKFwiZm9jdXNlZFwiKTtcclxuXHRcdGVsLmJsdXIoKTtcclxuXHR9KTtcclxuXHRhbGxTYXZlQnRucy5mb3JFYWNoKChidG4pID0+IGJ0bi5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpKTtcclxuXHRhbGxFZGl0QnRucy5mb3JFYWNoKChidG4pID0+IGJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpKTtcclxuXHJcblx0ZWRpdEJ0bi5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG59O1xyXG4iXX0=
